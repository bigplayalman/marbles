(function(){const B=document.createElement("link").relList;if(B&&B.supports&&B.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))T(d);new MutationObserver(d=>{for(const e of d)if(e.type==="childList")for(const n of e.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&T(n)}).observe(document,{childList:!0,subtree:!0});function b(d){const e={};return d.integrity&&(e.integrity=d.integrity),d.referrerPolicy&&(e.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?e.credentials="include":d.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function T(d){if(d.ep)return;d.ep=!0;const e=b(d);fetch(d.href,e)}})();const ne=20,Ge=350,te=20,Ye=3,Qe=["Thunderball","Big Red","Slick","Pebble","Cannonball","Dizzy","Rocket","Bouncer","Shadow","Blaze","Cyclone","Nugget","Comet","Rumble","Frost","Sparky","Vortex","Marble Madness","Rolling Thunder","Quicksilver","Jade","Onyx","Ruby","Sapphire","Turbo","Zigzag","Bullet","Drifter","Ace","Flash"],ke=["#FF4136","#FF851B","#FFDC00","#2ECC40","#0074D9","#B10DC9","#F012BE","#01FF70","#7FDBFF","#AAAAAA","#FF6B6B","#C44DFF","#FF9F43","#00D2D3","#EE5A24","#6C5CE7","#FDA7DF","#A3CB38","#1289A7","#D980FA"];function Ze(A){let B=A|0;return()=>{B=B+1831565813|0;let b=Math.imul(B^B>>>15,1|B);return b=b+Math.imul(b^b>>>7,61|b)^b,((b^b>>>14)>>>0)/4294967296}}function F(A,B,b){return B+A()*(b-B)}function se(A,B,b){return Math.floor(F(A,B,b+1))}function Ke(A,B){return B[Math.floor(A()*B.length)]}const ge=ne*2*3+20,Je=["slope","steep_slope","flat","funnel","wide_curve","zigzag","drop","narrow","gentle_bend","split","quarter_pipe","mini_ramp","half_pipe","lattice","lattice"];function he(A){const B=A.points[A.points.length-1],b=A.rightPoints[A.rightPoints.length-1];return{x:(B.x+b.x)/2,y:Math.max(B.y,b.y),leftX:B.x,leftY:B.y,rightX:b.x,rightY:b.y}}const qe=130;function De(A){if(A.length<3)return A;const B=qe*Math.PI/180;let b=[...A],T=!0,d=0;for(;T&&d<5;){T=!1,d++;const e=[b[0]];for(let n=1;n<b.length-1;n++){const o=b[n-1],s=b[n],c=b[n+1],a=o.x-s.x,r=o.y-s.y,i=c.x-s.x,t=c.y-s.y,l=a*i+r*t,f=Math.sqrt(a*a+r*r),u=Math.sqrt(i*i+t*t);if(f<1||u<1){e.push(s);continue}const x=l/(f*u);Math.acos(Math.max(-1,Math.min(1,x)))<B?(e.push({x:(o.x+s.x)/2,y:(o.y+s.y)/2}),e.push(s),e.push({x:(s.x+c.x)/2,y:(s.y+c.y)/2}),T=!0):e.push(s)}e.push(b[b.length-1]),b=e}return b}function O(A,B=3){if(A.length<3)return De(A);const b=[A[0]];for(let T=0;T<A.length-1;T++){const d=A[Math.max(0,T-1)],e=A[T],n=A[T+1],o=A[Math.min(A.length-1,T+2)];for(let s=1;s<=B;s++){const c=s/(B+1),a=c*c,r=a*c,i=.5*(2*e.x+(-d.x+n.x)*c+(2*d.x-5*e.x+4*n.x-o.x)*a+(-d.x+3*e.x-3*n.x+o.x)*r),t=.5*(2*e.y+(-d.y+n.y)*c+(2*d.y-5*e.y+4*n.y-o.y)*a+(-d.y+3*e.y-3*n.y+o.y)*r);b.push({x:i,y:t})}b.push(n)}return De(b)}function je(A){const B=Ze(A),b=[];let T=0,d=0,e=Ge;const n=_e(T,d,e);b.push(n);let o=he(n);T=o.x,d=o.y;const s=tt(o,e,B);b.push(s),o=he(s),T=o.x,d=o.y;const c=se(B,12,18);for(let M=0;M<c;M++){const p=Ke(B,Je),g=Fe(p,o,e,B);b.push(g),o=he(g),T=o.x,d=o.y,e=Math.max(250,Math.min(450,e+F(B,-20,20)))}const a=et(o,e);b.push(a);let r=1/0,i=1/0,t=-1/0,l=-1/0;for(const M of b)for(const p of[...M.points,...M.rightPoints])r=Math.min(r,p.x),i=Math.min(i,p.y),t=Math.max(t,p.x),l=Math.max(l,p.y);const f=b[0],u=f.points[0],x=f.rightPoints[0],S=(u.x+x.x)/2,C=u.y+20;return{seed:A,segments:b,startX:S,startY:C,width:t-r+200,height:l-i+200,funnelLeft:u.x,funnelRight:x.x,boundsMinX:r,boundsMaxX:t,boundsMinY:i,boundsMaxY:l}}function _e(A,B,b){const T=b*1.5,d=250;return{type:"funnel",points:O([{x:A-T/2,y:B},{x:A-T/2+20,y:B+d*.3},{x:A-b/2-15,y:B+d*.7},{x:A-b/2,y:B+d}]),rightPoints:O([{x:A+T/2,y:B},{x:A+T/2-20,y:B+d*.3},{x:A+b/2+15,y:B+d*.7},{x:A+b/2,y:B+d}])}}function et(A,B){const T=A.x,d=A.y;return{type:"finish",points:O([{x:A.leftX,y:A.leftY},{x:T-B/2,y:d+350*.4},{x:T-B/2,y:d+350},{x:T-B*.7,y:d+350+150}]),rightPoints:O([{x:A.rightX,y:A.rightY},{x:T+B/2,y:d+350*.4},{x:T+B/2,y:d+350},{x:T+B*.7,y:d+350+150}])}}function tt(A,B,b){const T=se(b,3,5),d=F(b,120,180),e=F(b,100,140),n=B*1.4,o=B*.6,s=n/2,c=21*Math.PI/180,a=A.x,r=A.y,i=[{x:A.leftX,y:A.leftY}],t=[{x:A.rightX,y:A.rightY}];i.push({x:a-s,y:r+30}),t.push({x:a+s,y:r+30});let l=r+30;const f=T*d+(T-1)*e;i.push({x:a-s,y:l+f}),t.push({x:a+s,y:l+f});const u=l+f+e;i.push({x:a-B/2,y:u}),t.push({x:a+B/2,y:u});const x=[];let S=l;for(let C=0;C<T;C++)if(S+=d,C<T-1){const M=C%2===0,p=a-s+10,g=a+s-10,y=o;let v,w;M?(v=p,w=g-y):(v=p+y,w=g);const h=Math.abs(w-v),m=Math.tan(c)*h;M?x.push([{x:v,y:S},{x:w,y:S+m}]):x.push([{x:v,y:S+m},{x:w,y:S}]),S+=e}return{type:"maze",points:i,rightPoints:t,dividers:x}}function Fe(A,B,b,T){const d=b/2,e=B.x,n=B.y,o=B.leftX,s=B.leftY,c=B.rightX,a=B.rightY;switch(A){case"slope":{const r=F(T,400,700),i=F(T,-60,60),t=i*.5;return{type:A,points:O([{x:o,y:s},{x:o+t*.3,y:n+r*.25},{x:o+t,y:n+r*.5},{x:o+t+(i-t)*.5,y:n+r*.75},{x:e-d+i,y:n+r}]),rightPoints:O([{x:c,y:a},{x:c+t*.3,y:n+r*.25},{x:c+t,y:n+r*.5},{x:c+t+(i-t)*.5,y:n+r*.75},{x:e+d+i,y:n+r}])}}case"steep_slope":{const r=F(T,500,800),i=F(T,-30,30);return{type:A,points:O([{x:o,y:s},{x:o+i*.2,y:n+r*.25},{x:o+i*.3,y:n+r*.5},{x:e-d*.9+i,y:n+r}]),rightPoints:O([{x:c,y:a},{x:c+i*.2,y:n+r*.25},{x:c+i*.3,y:n+r*.5},{x:e+d*.9+i,y:n+r}])}}case"flat":{const r=F(T,-80,80),i=F(T,60,140);return{type:A,points:O([{x:o,y:s},{x:o+r*.3,y:n+i*.3},{x:o+r*.5,y:n+i*.5},{x:o+r,y:n+i}]),rightPoints:O([{x:c,y:a},{x:c+r*.3,y:n+i*.3},{x:c+r*.5,y:n+i*.5},{x:c+r,y:n+i}])}}case"funnel":{const r=F(T,400,600),i=F(T,.6,.8),t=F(T,-40,40),l=Math.max(ge/2,d*i);return{type:A,points:O([{x:o,y:s},{x:(o*2+e-l+t)/3,y:n+r*.33},{x:(o+e-l+t)/2,y:n+r*.66},{x:e-l+t,y:n+r}]),rightPoints:O([{x:c,y:a},{x:(c*2+e+l+t)/3,y:n+r*.33},{x:(c+e+l+t)/2,y:n+r*.66},{x:e+l+t,y:n+r}])}}case"wide_curve":{const r=F(T,450,700),i=T()>.5?1:-1,t=F(T,60,100)*i;return{type:A,points:O([{x:o,y:s},{x:o+t*.2,y:n+r*.2},{x:o+t*.6,y:n+r*.4},{x:o+t,y:n+r*.5},{x:o+t*.8,y:n+r*.65},{x:o+t*.4,y:n+r*.85},{x:o+t*.2,y:n+r}]),rightPoints:O([{x:c,y:a},{x:c+t*.2,y:n+r*.2},{x:c+t*.6,y:n+r*.4},{x:c+t,y:n+r*.5},{x:c+t*.8,y:n+r*.65},{x:c+t*.4,y:n+r*.85},{x:c+t*.2,y:n+r}])}}case"zigzag":{const r=F(T,600,900),i=se(T,2,3),t=[{x:o,y:s}],l=[{x:c,y:a}],f=r/i;for(let u=0;u<i;u++){const S=(u%2===0?1:-1)*F(T,40,80),C=n+f*(u+.5),M=n+f*(u+1);t.push({x:e-d+S,y:C}),t.push({x:e-d+S*.3,y:M}),l.push({x:e+d+S,y:C}),l.push({x:e+d+S*.3,y:M})}return{type:A,points:O(t),rightPoints:O(l)}}case"drop":{const r=F(T,400,600),i=F(T,-25,25),t=Math.max(ge/2,d*.5);return{type:A,points:O([{x:o,y:s},{x:(o*2+e-t+i)/3,y:n+r*.15},{x:e-t+i,y:n+r*.3},{x:e-t+i,y:n+r*.7},{x:(e-d+i+e-t+i)/2,y:n+r*.85},{x:e-d+i,y:n+r}]),rightPoints:O([{x:c,y:a},{x:(c*2+e+t+i)/3,y:n+r*.15},{x:e+t+i,y:n+r*.3},{x:e+t+i,y:n+r*.7},{x:(e+d+i+e+t+i)/2,y:n+r*.85},{x:e+d+i,y:n+r}])}}case"narrow":{const r=F(T,400,600),i=Math.max(ge,F(T,140,200)),t=F(T,-30,30);return{type:A,points:O([{x:o,y:s},{x:(o*2+e-i/2+t)/3,y:n+r*.2},{x:e-i/2+t,y:n+r*.35},{x:e-i/2+t,y:n+r*.65},{x:(e-d+t+e-i/2+t)/2,y:n+r*.8},{x:e-d+t,y:n+r}]),rightPoints:O([{x:c,y:a},{x:(c*2+e+i/2+t)/3,y:n+r*.2},{x:e+i/2+t,y:n+r*.35},{x:e+i/2+t,y:n+r*.65},{x:(e+d+t+e+i/2+t)/2,y:n+r*.8},{x:e+d+t,y:n+r}])}}case"gentle_bend":{const r=F(T,400,600),i=T()>.5?1:-1,t=F(T,40,70)*i;return{type:A,points:O([{x:o,y:s},{x:o+t*.3,y:n+r*.25},{x:o+t*.5,y:n+r*.33},{x:o+t,y:n+r*.55},{x:o+t*.8,y:n+r*.75},{x:o+t*.5,y:n+r}]),rightPoints:O([{x:c,y:a},{x:c+t*.3,y:n+r*.25},{x:c+t*.5,y:n+r*.33},{x:c+t,y:n+r*.55},{x:c+t*.8,y:n+r*.75},{x:c+t*.5,y:n+r}])}}case"split":{const r=se(T,1,3),i=F(T,700,1e3),t=F(T,-25,25),l=1.3+r*.25,f=b*F(T,l-.1,l+.1),u=f/2,x=.12,S=.88,C=e+t,M=T()>.5?1:-1,p=F(T,30,90)*M,g=m=>p*Math.sin(m*Math.PI),y=[0,.08,.2,.35,.5,.65,.8,.92,1],v=y.map((m,P)=>{if(P===0)return{x:o,y:s};if(P===y.length-1)return{x:e-d+t,y:n+i};const I=g(m);return{x:C-u+I,y:n+i*m}}),w=y.map((m,P)=>{if(P===0)return{x:c,y:a};if(P===y.length-1)return{x:e+d+t,y:n+i};const I=g(m);return{x:C+u+I,y:n+i*m}}),h=[];for(let m=0;m<r;m++){const P=(m+1)/(r+1),I=C-u+f*P,R=F(T,-15,15),L=[x,.25,.4,.5,.6,.75,S].map(D=>{const k=g(D),H=R*Math.sin(D*Math.PI*2);return{x:I+k+H,y:n+i*D}});h.push(O(L))}return{type:A,points:O(v),rightPoints:O(w),dividers:h}}case"quarter_pipe":{const r=F(T,500,750),i=T()>.5?1:-1,t=F(T,80,140)*i,l=8,f=[],u=[];for(let x=0;x<=l;x++){const S=x/l,C=t*Math.sin(S*Math.PI),M=n+r*S;f.push({x:o+C,y:M}),u.push({x:c+C,y:M})}return{type:A,points:O(f),rightPoints:O(u)}}case"mini_ramp":{const r=F(T,500,700),i=F(T,-30,30),t=F(T,40,80),l=T()>.5?1:-1;return{type:A,points:O([{x:o,y:s},{x:o+i*.2+l*t*.3,y:n+r*.15},{x:o+i*.3+l*t,y:n+r*.3},{x:o+i*.4+l*t*.8,y:n+r*.45},{x:o+i*.5,y:n+r*.55},{x:o+i*.6-l*t*.3,y:n+r*.7},{x:o+i*.8,y:n+r*.85},{x:e-d+i,y:n+r}]),rightPoints:O([{x:c,y:a},{x:c+i*.2+l*t*.3,y:n+r*.15},{x:c+i*.3+l*t,y:n+r*.3},{x:c+i*.4+l*t*.8,y:n+r*.45},{x:c+i*.5,y:n+r*.55},{x:c+i*.6-l*t*.3,y:n+r*.7},{x:c+i*.8,y:n+r*.85},{x:e+d+i,y:n+r}])}}case"lattice":{const r=se(T,3,5),i=F(T,1e3,1500),t=F(T,-20,20),l=b*F(T,1.6,2),f=l/2,u=e+t,x=i*.1,S=i*.1,M=(i-x-S)/(r+1),p=se(T,2,4),g=F(T,40,65),y=F(T,30,45)*Math.PI/180,v=Math.cos(y)*g/2,w=Math.sin(y)*g/2,h=[{x:o,y:s},{x:u-f,y:n+x*.5},{x:u-f,y:n+i-S*.5},{x:e-d+t,y:n+i}],m=[{x:c,y:a},{x:u+f,y:n+x*.5},{x:u+f,y:n+i-S*.5},{x:e+d+t,y:n+i}],P=[],I=ne*4,R=l-I*2;for(let E=0;E<r;E++){const L=n+x+M*(E+1),D=E%2===1,k=D?p-1:p;if(k<=0)continue;const H=R/(D?p:p+1),W=u-f+I;for(let V=0;V<k;V++){let U;D?U=W+H*(V+1):U=W+H*(V+.5),U+=F(T,-12,12);const N=L+F(T,-8,8),K=(E+V)%2===0?1:-1;P.push([{x:U-v,y:N-w*K},{x:U+v,y:N+w*K}])}}return{type:A,points:O(h),rightPoints:O(m),dividers:P}}case"half_pipe":{const r=F(T,600,900),i=F(T,80,130),t=T()>.5?1:-1;return{type:A,points:O([{x:o,y:s},{x:o+t*i*.4,y:n+r*.1},{x:o+t*i,y:n+r*.2},{x:o+t*i*.8,y:n+r*.3},{x:o,y:n+r*.4},{x:o-t*i*.8,y:n+r*.5},{x:o-t*i,y:n+r*.6},{x:o-t*i*.8,y:n+r*.7},{x:o,y:n+r*.8},{x:o+t*i*.3,y:n+r*.9},{x:e-d,y:n+r}]),rightPoints:O([{x:c,y:a},{x:c+t*i*.4,y:n+r*.1},{x:c+t*i,y:n+r*.2},{x:c+t*i*.8,y:n+r*.3},{x:c,y:n+r*.4},{x:c-t*i*.8,y:n+r*.5},{x:c-t*i,y:n+r*.6},{x:c-t*i*.8,y:n+r*.7},{x:c,y:n+r*.8},{x:c+t*i*.3,y:n+r*.9},{x:e+d,y:n+r}])}}default:return Fe("slope",B,b,T)}}function nt(A){return A.segments[A.segments.length-1].points[0].y}var ve=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function it(A){return A&&A.__esModule&&Object.prototype.hasOwnProperty.call(A,"default")?A.default:A}var He={exports:{}};/*!
 * matter-js 0.20.0 by @liabru
 * http://brm.io/matter-js/
 * License MIT
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) Liam Brummitt and contributors.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */(function(A,B){(function(T,d){A.exports=d()})(ve,function(){return function(b){var T={};function d(e){if(T[e])return T[e].exports;var n=T[e]={i:e,l:!1,exports:{}};return b[e].call(n.exports,n,n.exports,d),n.l=!0,n.exports}return d.m=b,d.c=T,d.d=function(e,n,o){d.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},d.r=function(e){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},d.t=function(e,n){if(n&1&&(e=d(e)),n&8||n&4&&typeof e=="object"&&e&&e.__esModule)return e;var o=Object.create(null);if(d.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),n&2&&typeof e!="string")for(var s in e)d.d(o,s,(function(c){return e[c]}).bind(null,s));return o},d.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return d.d(n,"a",n),n},d.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},d.p="",d(d.s=20)}([function(b,T){var d={};b.exports=d,function(){d._baseDelta=1e3/60,d._nextId=0,d._seed=0,d._nowStartTime=+new Date,d._warnedOnce={},d._decomp=null,d.extend=function(n,o){var s,c;typeof o=="boolean"?(s=2,c=o):(s=1,c=!0);for(var a=s;a<arguments.length;a++){var r=arguments[a];if(r)for(var i in r)c&&r[i]&&r[i].constructor===Object&&(!n[i]||n[i].constructor===Object)?(n[i]=n[i]||{},d.extend(n[i],c,r[i])):n[i]=r[i]}return n},d.clone=function(n,o){return d.extend({},o,n)},d.keys=function(n){if(Object.keys)return Object.keys(n);var o=[];for(var s in n)o.push(s);return o},d.values=function(n){var o=[];if(Object.keys){for(var s=Object.keys(n),c=0;c<s.length;c++)o.push(n[s[c]]);return o}for(var a in n)o.push(n[a]);return o},d.get=function(n,o,s,c){o=o.split(".").slice(s,c);for(var a=0;a<o.length;a+=1)n=n[o[a]];return n},d.set=function(n,o,s,c,a){var r=o.split(".").slice(c,a);return d.get(n,o,0,-1)[r[r.length-1]]=s,s},d.shuffle=function(n){for(var o=n.length-1;o>0;o--){var s=Math.floor(d.random()*(o+1)),c=n[o];n[o]=n[s],n[s]=c}return n},d.choose=function(n){return n[Math.floor(d.random()*n.length)]},d.isElement=function(n){return typeof HTMLElement<"u"?n instanceof HTMLElement:!!(n&&n.nodeType&&n.nodeName)},d.isArray=function(n){return Object.prototype.toString.call(n)==="[object Array]"},d.isFunction=function(n){return typeof n=="function"},d.isPlainObject=function(n){return typeof n=="object"&&n.constructor===Object},d.isString=function(n){return toString.call(n)==="[object String]"},d.clamp=function(n,o,s){return n<o?o:n>s?s:n},d.sign=function(n){return n<0?-1:1},d.now=function(){if(typeof window<"u"&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-d._nowStartTime},d.random=function(n,o){return n=typeof n<"u"?n:0,o=typeof o<"u"?o:1,n+e()*(o-n)};var e=function(){return d._seed=(d._seed*9301+49297)%233280,d._seed/233280};d.colorToNumber=function(n){return n=n.replace("#",""),n.length==3&&(n=n.charAt(0)+n.charAt(0)+n.charAt(1)+n.charAt(1)+n.charAt(2)+n.charAt(2)),parseInt(n,16)},d.logLevel=1,d.log=function(){console&&d.logLevel>0&&d.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},d.info=function(){console&&d.logLevel>0&&d.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},d.warn=function(){console&&d.logLevel>0&&d.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},d.warnOnce=function(){var n=Array.prototype.slice.call(arguments).join(" ");d._warnedOnce[n]||(d.warn(n),d._warnedOnce[n]=!0)},d.deprecated=function(n,o,s){n[o]=d.chain(function(){d.warnOnce("ðŸ”… deprecated ðŸ”…",s)},n[o])},d.nextId=function(){return d._nextId++},d.indexOf=function(n,o){if(n.indexOf)return n.indexOf(o);for(var s=0;s<n.length;s++)if(n[s]===o)return s;return-1},d.map=function(n,o){if(n.map)return n.map(o);for(var s=[],c=0;c<n.length;c+=1)s.push(o(n[c]));return s},d.topologicalSort=function(n){var o=[],s=[],c=[];for(var a in n)!s[a]&&!c[a]&&d._topologicalSort(a,s,c,n,o);return o},d._topologicalSort=function(n,o,s,c,a){var r=c[n]||[];s[n]=!0;for(var i=0;i<r.length;i+=1){var t=r[i];s[t]||o[t]||d._topologicalSort(t,o,s,c,a)}s[n]=!1,o[n]=!0,a.push(n)},d.chain=function(){for(var n=[],o=0;o<arguments.length;o+=1){var s=arguments[o];s._chained?n.push.apply(n,s._chained):n.push(s)}var c=function(){for(var a,r=new Array(arguments.length),i=0,t=arguments.length;i<t;i++)r[i]=arguments[i];for(i=0;i<n.length;i+=1){var l=n[i].apply(a,r);typeof l<"u"&&(a=l)}return a};return c._chained=n,c},d.chainPathBefore=function(n,o,s){return d.set(n,o,d.chain(s,d.get(n,o)))},d.chainPathAfter=function(n,o,s){return d.set(n,o,d.chain(d.get(n,o),s))},d.setDecomp=function(n){d._decomp=n},d.getDecomp=function(){var n=d._decomp;try{!n&&typeof window<"u"&&(n=window.decomp),!n&&typeof ve<"u"&&(n=ve.decomp)}catch{n=null}return n}}()},function(b,T){var d={};b.exports=d,function(){d.create=function(e){var n={min:{x:0,y:0},max:{x:0,y:0}};return e&&d.update(n,e),n},d.update=function(e,n,o){e.min.x=1/0,e.max.x=-1/0,e.min.y=1/0,e.max.y=-1/0;for(var s=0;s<n.length;s++){var c=n[s];c.x>e.max.x&&(e.max.x=c.x),c.x<e.min.x&&(e.min.x=c.x),c.y>e.max.y&&(e.max.y=c.y),c.y<e.min.y&&(e.min.y=c.y)}o&&(o.x>0?e.max.x+=o.x:e.min.x+=o.x,o.y>0?e.max.y+=o.y:e.min.y+=o.y)},d.contains=function(e,n){return n.x>=e.min.x&&n.x<=e.max.x&&n.y>=e.min.y&&n.y<=e.max.y},d.overlaps=function(e,n){return e.min.x<=n.max.x&&e.max.x>=n.min.x&&e.max.y>=n.min.y&&e.min.y<=n.max.y},d.translate=function(e,n){e.min.x+=n.x,e.max.x+=n.x,e.min.y+=n.y,e.max.y+=n.y},d.shift=function(e,n){var o=e.max.x-e.min.x,s=e.max.y-e.min.y;e.min.x=n.x,e.max.x=n.x+o,e.min.y=n.y,e.max.y=n.y+s}}()},function(b,T){var d={};b.exports=d,function(){d.create=function(e,n){return{x:e||0,y:n||0}},d.clone=function(e){return{x:e.x,y:e.y}},d.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},d.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},d.rotate=function(e,n,o){var s=Math.cos(n),c=Math.sin(n);o||(o={});var a=e.x*s-e.y*c;return o.y=e.x*c+e.y*s,o.x=a,o},d.rotateAbout=function(e,n,o,s){var c=Math.cos(n),a=Math.sin(n);s||(s={});var r=o.x+((e.x-o.x)*c-(e.y-o.y)*a);return s.y=o.y+((e.x-o.x)*a+(e.y-o.y)*c),s.x=r,s},d.normalise=function(e){var n=d.magnitude(e);return n===0?{x:0,y:0}:{x:e.x/n,y:e.y/n}},d.dot=function(e,n){return e.x*n.x+e.y*n.y},d.cross=function(e,n){return e.x*n.y-e.y*n.x},d.cross3=function(e,n,o){return(n.x-e.x)*(o.y-e.y)-(n.y-e.y)*(o.x-e.x)},d.add=function(e,n,o){return o||(o={}),o.x=e.x+n.x,o.y=e.y+n.y,o},d.sub=function(e,n,o){return o||(o={}),o.x=e.x-n.x,o.y=e.y-n.y,o},d.mult=function(e,n){return{x:e.x*n,y:e.y*n}},d.div=function(e,n){return{x:e.x/n,y:e.y/n}},d.perp=function(e,n){return n=n===!0?-1:1,{x:n*-e.y,y:n*e.x}},d.neg=function(e){return{x:-e.x,y:-e.y}},d.angle=function(e,n){return Math.atan2(n.y-e.y,n.x-e.x)},d._temp=[d.create(),d.create(),d.create(),d.create(),d.create(),d.create()]}()},function(b,T,d){var e={};b.exports=e;var n=d(2),o=d(0);(function(){e.create=function(s,c){for(var a=[],r=0;r<s.length;r++){var i=s[r],t={x:i.x,y:i.y,index:r,body:c,isInternal:!1};a.push(t)}return a},e.fromPath=function(s,c){var a=/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/ig,r=[];return s.replace(a,function(i,t,l){r.push({x:parseFloat(t),y:parseFloat(l)})}),e.create(r,c)},e.centre=function(s){for(var c=e.area(s,!0),a={x:0,y:0},r,i,t,l=0;l<s.length;l++)t=(l+1)%s.length,r=n.cross(s[l],s[t]),i=n.mult(n.add(s[l],s[t]),r),a=n.add(a,i);return n.div(a,6*c)},e.mean=function(s){for(var c={x:0,y:0},a=0;a<s.length;a++)c.x+=s[a].x,c.y+=s[a].y;return n.div(c,s.length)},e.area=function(s,c){for(var a=0,r=s.length-1,i=0;i<s.length;i++)a+=(s[r].x-s[i].x)*(s[r].y+s[i].y),r=i;return c?a/2:Math.abs(a)/2},e.inertia=function(s,c){for(var a=0,r=0,i=s,t,l,f=0;f<i.length;f++)l=(f+1)%i.length,t=Math.abs(n.cross(i[l],i[f])),a+=t*(n.dot(i[l],i[l])+n.dot(i[l],i[f])+n.dot(i[f],i[f])),r+=t;return c/6*(a/r)},e.translate=function(s,c,a){a=typeof a<"u"?a:1;var r=s.length,i=c.x*a,t=c.y*a,l;for(l=0;l<r;l++)s[l].x+=i,s[l].y+=t;return s},e.rotate=function(s,c,a){if(c!==0){var r=Math.cos(c),i=Math.sin(c),t=a.x,l=a.y,f=s.length,u,x,S,C;for(C=0;C<f;C++)u=s[C],x=u.x-t,S=u.y-l,u.x=t+(x*r-S*i),u.y=l+(x*i+S*r);return s}},e.contains=function(s,c){for(var a=c.x,r=c.y,i=s.length,t=s[i-1],l,f=0;f<i;f++){if(l=s[f],(a-t.x)*(l.y-t.y)+(r-t.y)*(t.x-l.x)>0)return!1;t=l}return!0},e.scale=function(s,c,a,r){if(c===1&&a===1)return s;r=r||e.centre(s);for(var i,t,l=0;l<s.length;l++)i=s[l],t=n.sub(i,r),s[l].x=r.x+t.x*c,s[l].y=r.y+t.y*a;return s},e.chamfer=function(s,c,a,r,i){typeof c=="number"?c=[c]:c=c||[8],a=typeof a<"u"?a:-1,r=r||2,i=i||14;for(var t=[],l=0;l<s.length;l++){var f=s[l-1>=0?l-1:s.length-1],u=s[l],x=s[(l+1)%s.length],S=c[l<c.length?l:c.length-1];if(S===0){t.push(u);continue}var C=n.normalise({x:u.y-f.y,y:f.x-u.x}),M=n.normalise({x:x.y-u.y,y:u.x-x.x}),p=Math.sqrt(2*Math.pow(S,2)),g=n.mult(o.clone(C),S),y=n.normalise(n.mult(n.add(C,M),.5)),v=n.sub(u,n.mult(y,p)),w=a;a===-1&&(w=Math.pow(S,.32)*1.75),w=o.clamp(w,r,i),w%2===1&&(w+=1);for(var h=Math.acos(n.dot(C,M)),m=h/w,P=0;P<w;P++)t.push(n.add(n.rotate(g,m*P),v))}return t},e.clockwiseSort=function(s){var c=e.mean(s);return s.sort(function(a,r){return n.angle(c,a)-n.angle(c,r)}),s},e.isConvex=function(s){var c=0,a=s.length,r,i,t,l;if(a<3)return null;for(r=0;r<a;r++)if(i=(r+1)%a,t=(r+2)%a,l=(s[i].x-s[r].x)*(s[t].y-s[i].y),l-=(s[i].y-s[r].y)*(s[t].x-s[i].x),l<0?c|=1:l>0&&(c|=2),c===3)return!1;return c!==0?!0:null},e.hull=function(s){var c=[],a=[],r,i;for(s=s.slice(0),s.sort(function(t,l){var f=t.x-l.x;return f!==0?f:t.y-l.y}),i=0;i<s.length;i+=1){for(r=s[i];a.length>=2&&n.cross3(a[a.length-2],a[a.length-1],r)<=0;)a.pop();a.push(r)}for(i=s.length-1;i>=0;i-=1){for(r=s[i];c.length>=2&&n.cross3(c[c.length-2],c[c.length-1],r)<=0;)c.pop();c.push(r)}return c.pop(),a.pop(),c.concat(a)}})()},function(b,T,d){var e={};b.exports=e;var n=d(3),o=d(2),s=d(7),c=d(0),a=d(1),r=d(11);(function(){e._timeCorrection=!0,e._inertiaScale=4,e._nextCollidingGroupId=1,e._nextNonCollidingGroupId=-1,e._nextCategory=1,e._baseDelta=1e3/60,e.create=function(t){var l={id:c.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:n.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,deltaTime:16.666666666666668,_original:null},f=c.extend(l,t);return i(f,t),f},e.nextGroup=function(t){return t?e._nextNonCollidingGroupId--:e._nextCollidingGroupId++},e.nextCategory=function(){return e._nextCategory=e._nextCategory<<1,e._nextCategory};var i=function(t,l){l=l||{},e.set(t,{bounds:t.bounds||a.create(t.vertices),positionPrev:t.positionPrev||o.clone(t.position),anglePrev:t.anglePrev||t.angle,vertices:t.vertices,parts:t.parts||[t],isStatic:t.isStatic,isSleeping:t.isSleeping,parent:t.parent||t}),n.rotate(t.vertices,t.angle,t.position),r.rotate(t.axes,t.angle),a.update(t.bounds,t.vertices,t.velocity),e.set(t,{axes:l.axes||t.axes,area:l.area||t.area,mass:l.mass||t.mass,inertia:l.inertia||t.inertia});var f=t.isStatic?"#14151f":c.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),u=t.isStatic?"#555":"#ccc",x=t.isStatic&&t.render.fillStyle===null?1:0;t.render.fillStyle=t.render.fillStyle||f,t.render.strokeStyle=t.render.strokeStyle||u,t.render.lineWidth=t.render.lineWidth||x,t.render.sprite.xOffset+=-(t.bounds.min.x-t.position.x)/(t.bounds.max.x-t.bounds.min.x),t.render.sprite.yOffset+=-(t.bounds.min.y-t.position.y)/(t.bounds.max.y-t.bounds.min.y)};e.set=function(t,l,f){var u;typeof l=="string"&&(u=l,l={},l[u]=f);for(u in l)if(Object.prototype.hasOwnProperty.call(l,u))switch(f=l[u],u){case"isStatic":e.setStatic(t,f);break;case"isSleeping":s.set(t,f);break;case"mass":e.setMass(t,f);break;case"density":e.setDensity(t,f);break;case"inertia":e.setInertia(t,f);break;case"vertices":e.setVertices(t,f);break;case"position":e.setPosition(t,f);break;case"angle":e.setAngle(t,f);break;case"velocity":e.setVelocity(t,f);break;case"angularVelocity":e.setAngularVelocity(t,f);break;case"speed":e.setSpeed(t,f);break;case"angularSpeed":e.setAngularSpeed(t,f);break;case"parts":e.setParts(t,f);break;case"centre":e.setCentre(t,f);break;default:t[u]=f}},e.setStatic=function(t,l){for(var f=0;f<t.parts.length;f++){var u=t.parts[f];l?(u.isStatic||(u._original={restitution:u.restitution,friction:u.friction,mass:u.mass,inertia:u.inertia,density:u.density,inverseMass:u.inverseMass,inverseInertia:u.inverseInertia}),u.restitution=0,u.friction=1,u.mass=u.inertia=u.density=1/0,u.inverseMass=u.inverseInertia=0,u.positionPrev.x=u.position.x,u.positionPrev.y=u.position.y,u.anglePrev=u.angle,u.angularVelocity=0,u.speed=0,u.angularSpeed=0,u.motion=0):u._original&&(u.restitution=u._original.restitution,u.friction=u._original.friction,u.mass=u._original.mass,u.inertia=u._original.inertia,u.density=u._original.density,u.inverseMass=u._original.inverseMass,u.inverseInertia=u._original.inverseInertia,u._original=null),u.isStatic=l}},e.setMass=function(t,l){var f=t.inertia/(t.mass/6);t.inertia=f*(l/6),t.inverseInertia=1/t.inertia,t.mass=l,t.inverseMass=1/t.mass,t.density=t.mass/t.area},e.setDensity=function(t,l){e.setMass(t,l*t.area),t.density=l},e.setInertia=function(t,l){t.inertia=l,t.inverseInertia=1/t.inertia},e.setVertices=function(t,l){l[0].body===t?t.vertices=l:t.vertices=n.create(l,t),t.axes=r.fromVertices(t.vertices),t.area=n.area(t.vertices),e.setMass(t,t.density*t.area);var f=n.centre(t.vertices);n.translate(t.vertices,f,-1),e.setInertia(t,e._inertiaScale*n.inertia(t.vertices,t.mass)),n.translate(t.vertices,t.position),a.update(t.bounds,t.vertices,t.velocity)},e.setParts=function(t,l,f){var u;for(l=l.slice(0),t.parts.length=0,t.parts.push(t),t.parent=t,u=0;u<l.length;u++){var x=l[u];x!==t&&(x.parent=t,t.parts.push(x))}if(t.parts.length!==1){if(f=typeof f<"u"?f:!0,f){var S=[];for(u=0;u<l.length;u++)S=S.concat(l[u].vertices);n.clockwiseSort(S);var C=n.hull(S),M=n.centre(C);e.setVertices(t,C),n.translate(t.vertices,M)}var p=e._totalProperties(t);t.area=p.area,t.parent=t,t.position.x=p.centre.x,t.position.y=p.centre.y,t.positionPrev.x=p.centre.x,t.positionPrev.y=p.centre.y,e.setMass(t,p.mass),e.setInertia(t,p.inertia),e.setPosition(t,p.centre)}},e.setCentre=function(t,l,f){f?(t.positionPrev.x+=l.x,t.positionPrev.y+=l.y,t.position.x+=l.x,t.position.y+=l.y):(t.positionPrev.x=l.x-(t.position.x-t.positionPrev.x),t.positionPrev.y=l.y-(t.position.y-t.positionPrev.y),t.position.x=l.x,t.position.y=l.y)},e.setPosition=function(t,l,f){var u=o.sub(l,t.position);f?(t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.velocity.x=u.x,t.velocity.y=u.y,t.speed=o.magnitude(u)):(t.positionPrev.x+=u.x,t.positionPrev.y+=u.y);for(var x=0;x<t.parts.length;x++){var S=t.parts[x];S.position.x+=u.x,S.position.y+=u.y,n.translate(S.vertices,u),a.update(S.bounds,S.vertices,t.velocity)}},e.setAngle=function(t,l,f){var u=l-t.angle;f?(t.anglePrev=t.angle,t.angularVelocity=u,t.angularSpeed=Math.abs(u)):t.anglePrev+=u;for(var x=0;x<t.parts.length;x++){var S=t.parts[x];S.angle+=u,n.rotate(S.vertices,u,t.position),r.rotate(S.axes,u),a.update(S.bounds,S.vertices,t.velocity),x>0&&o.rotateAbout(S.position,u,t.position,S.position)}},e.setVelocity=function(t,l){var f=t.deltaTime/e._baseDelta;t.positionPrev.x=t.position.x-l.x*f,t.positionPrev.y=t.position.y-l.y*f,t.velocity.x=(t.position.x-t.positionPrev.x)/f,t.velocity.y=(t.position.y-t.positionPrev.y)/f,t.speed=o.magnitude(t.velocity)},e.getVelocity=function(t){var l=e._baseDelta/t.deltaTime;return{x:(t.position.x-t.positionPrev.x)*l,y:(t.position.y-t.positionPrev.y)*l}},e.getSpeed=function(t){return o.magnitude(e.getVelocity(t))},e.setSpeed=function(t,l){e.setVelocity(t,o.mult(o.normalise(e.getVelocity(t)),l))},e.setAngularVelocity=function(t,l){var f=t.deltaTime/e._baseDelta;t.anglePrev=t.angle-l*f,t.angularVelocity=(t.angle-t.anglePrev)/f,t.angularSpeed=Math.abs(t.angularVelocity)},e.getAngularVelocity=function(t){return(t.angle-t.anglePrev)*e._baseDelta/t.deltaTime},e.getAngularSpeed=function(t){return Math.abs(e.getAngularVelocity(t))},e.setAngularSpeed=function(t,l){e.setAngularVelocity(t,c.sign(e.getAngularVelocity(t))*l)},e.translate=function(t,l,f){e.setPosition(t,o.add(t.position,l),f)},e.rotate=function(t,l,f,u){if(!f)e.setAngle(t,t.angle+l,u);else{var x=Math.cos(l),S=Math.sin(l),C=t.position.x-f.x,M=t.position.y-f.y;e.setPosition(t,{x:f.x+(C*x-M*S),y:f.y+(C*S+M*x)},u),e.setAngle(t,t.angle+l,u)}},e.scale=function(t,l,f,u){var x=0,S=0;u=u||t.position;for(var C=0;C<t.parts.length;C++){var M=t.parts[C];n.scale(M.vertices,l,f,u),M.axes=r.fromVertices(M.vertices),M.area=n.area(M.vertices),e.setMass(M,t.density*M.area),n.translate(M.vertices,{x:-M.position.x,y:-M.position.y}),e.setInertia(M,e._inertiaScale*n.inertia(M.vertices,M.mass)),n.translate(M.vertices,{x:M.position.x,y:M.position.y}),C>0&&(x+=M.area,S+=M.inertia),M.position.x=u.x+(M.position.x-u.x)*l,M.position.y=u.y+(M.position.y-u.y)*f,a.update(M.bounds,M.vertices,t.velocity)}t.parts.length>1&&(t.area=x,t.isStatic||(e.setMass(t,t.density*x),e.setInertia(t,S))),t.circleRadius&&(l===f?t.circleRadius*=l:t.circleRadius=null)},e.update=function(t,l){l=(typeof l<"u"?l:1e3/60)*t.timeScale;var f=l*l,u=e._timeCorrection?l/(t.deltaTime||l):1,x=1-t.frictionAir*(l/c._baseDelta),S=(t.position.x-t.positionPrev.x)*u,C=(t.position.y-t.positionPrev.y)*u;t.velocity.x=S*x+t.force.x/t.mass*f,t.velocity.y=C*x+t.force.y/t.mass*f,t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.position.x+=t.velocity.x,t.position.y+=t.velocity.y,t.deltaTime=l,t.angularVelocity=(t.angle-t.anglePrev)*x*u+t.torque/t.inertia*f,t.anglePrev=t.angle,t.angle+=t.angularVelocity;for(var M=0;M<t.parts.length;M++){var p=t.parts[M];n.translate(p.vertices,t.velocity),M>0&&(p.position.x+=t.velocity.x,p.position.y+=t.velocity.y),t.angularVelocity!==0&&(n.rotate(p.vertices,t.angularVelocity,t.position),r.rotate(p.axes,t.angularVelocity),M>0&&o.rotateAbout(p.position,t.angularVelocity,t.position,p.position)),a.update(p.bounds,p.vertices,t.velocity)}},e.updateVelocities=function(t){var l=e._baseDelta/t.deltaTime,f=t.velocity;f.x=(t.position.x-t.positionPrev.x)*l,f.y=(t.position.y-t.positionPrev.y)*l,t.speed=Math.sqrt(f.x*f.x+f.y*f.y),t.angularVelocity=(t.angle-t.anglePrev)*l,t.angularSpeed=Math.abs(t.angularVelocity)},e.applyForce=function(t,l,f){var u={x:l.x-t.position.x,y:l.y-t.position.y};t.force.x+=f.x,t.force.y+=f.y,t.torque+=u.x*f.y-u.y*f.x},e._totalProperties=function(t){for(var l={mass:0,area:0,inertia:0,centre:{x:0,y:0}},f=t.parts.length===1?0:1;f<t.parts.length;f++){var u=t.parts[f],x=u.mass!==1/0?u.mass:1;l.mass+=x,l.area+=u.area,l.inertia+=u.inertia,l.centre=o.add(l.centre,o.mult(u.position,x))}return l.centre=o.div(l.centre,l.mass),l}})()},function(b,T,d){var e={};b.exports=e;var n=d(0);(function(){e.on=function(o,s,c){for(var a=s.split(" "),r,i=0;i<a.length;i++)r=a[i],o.events=o.events||{},o.events[r]=o.events[r]||[],o.events[r].push(c);return c},e.off=function(o,s,c){if(!s){o.events={};return}typeof s=="function"&&(c=s,s=n.keys(o.events).join(" "));for(var a=s.split(" "),r=0;r<a.length;r++){var i=o.events[a[r]],t=[];if(c&&i)for(var l=0;l<i.length;l++)i[l]!==c&&t.push(i[l]);o.events[a[r]]=t}},e.trigger=function(o,s,c){var a,r,i,t,l=o.events;if(l&&n.keys(l).length>0){c||(c={}),a=s.split(" ");for(var f=0;f<a.length;f++)if(r=a[f],i=l[r],i){t=n.clone(c,!1),t.name=r,t.source=o;for(var u=0;u<i.length;u++)i[u].apply(o,[t])}}}})()},function(b,T,d){var e={};b.exports=e;var n=d(5),o=d(0),s=d(1),c=d(4);(function(){e.create=function(a){return o.extend({id:o.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},a)},e.setModified=function(a,r,i,t){if(a.isModified=r,r&&a.cache&&(a.cache.allBodies=null,a.cache.allConstraints=null,a.cache.allComposites=null),i&&a.parent&&e.setModified(a.parent,r,i,t),t)for(var l=0;l<a.composites.length;l++){var f=a.composites[l];e.setModified(f,r,i,t)}},e.add=function(a,r){var i=[].concat(r);n.trigger(a,"beforeAdd",{object:r});for(var t=0;t<i.length;t++){var l=i[t];switch(l.type){case"body":if(l.parent!==l){o.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}e.addBody(a,l);break;case"constraint":e.addConstraint(a,l);break;case"composite":e.addComposite(a,l);break;case"mouseConstraint":e.addConstraint(a,l.constraint);break}}return n.trigger(a,"afterAdd",{object:r}),a},e.remove=function(a,r,i){var t=[].concat(r);n.trigger(a,"beforeRemove",{object:r});for(var l=0;l<t.length;l++){var f=t[l];switch(f.type){case"body":e.removeBody(a,f,i);break;case"constraint":e.removeConstraint(a,f,i);break;case"composite":e.removeComposite(a,f,i);break;case"mouseConstraint":e.removeConstraint(a,f.constraint);break}}return n.trigger(a,"afterRemove",{object:r}),a},e.addComposite=function(a,r){return a.composites.push(r),r.parent=a,e.setModified(a,!0,!0,!1),a},e.removeComposite=function(a,r,i){var t=o.indexOf(a.composites,r);if(t!==-1){var l=e.allBodies(r);e.removeCompositeAt(a,t);for(var f=0;f<l.length;f++)l[f].sleepCounter=0}if(i)for(var f=0;f<a.composites.length;f++)e.removeComposite(a.composites[f],r,!0);return a},e.removeCompositeAt=function(a,r){return a.composites.splice(r,1),e.setModified(a,!0,!0,!1),a},e.addBody=function(a,r){return a.bodies.push(r),e.setModified(a,!0,!0,!1),a},e.removeBody=function(a,r,i){var t=o.indexOf(a.bodies,r);if(t!==-1&&(e.removeBodyAt(a,t),r.sleepCounter=0),i)for(var l=0;l<a.composites.length;l++)e.removeBody(a.composites[l],r,!0);return a},e.removeBodyAt=function(a,r){return a.bodies.splice(r,1),e.setModified(a,!0,!0,!1),a},e.addConstraint=function(a,r){return a.constraints.push(r),e.setModified(a,!0,!0,!1),a},e.removeConstraint=function(a,r,i){var t=o.indexOf(a.constraints,r);if(t!==-1&&e.removeConstraintAt(a,t),i)for(var l=0;l<a.composites.length;l++)e.removeConstraint(a.composites[l],r,!0);return a},e.removeConstraintAt=function(a,r){return a.constraints.splice(r,1),e.setModified(a,!0,!0,!1),a},e.clear=function(a,r,i){if(i)for(var t=0;t<a.composites.length;t++)e.clear(a.composites[t],r,!0);return r?a.bodies=a.bodies.filter(function(l){return l.isStatic}):a.bodies.length=0,a.constraints.length=0,a.composites.length=0,e.setModified(a,!0,!0,!1),a},e.allBodies=function(a){if(a.cache&&a.cache.allBodies)return a.cache.allBodies;for(var r=[].concat(a.bodies),i=0;i<a.composites.length;i++)r=r.concat(e.allBodies(a.composites[i]));return a.cache&&(a.cache.allBodies=r),r},e.allConstraints=function(a){if(a.cache&&a.cache.allConstraints)return a.cache.allConstraints;for(var r=[].concat(a.constraints),i=0;i<a.composites.length;i++)r=r.concat(e.allConstraints(a.composites[i]));return a.cache&&(a.cache.allConstraints=r),r},e.allComposites=function(a){if(a.cache&&a.cache.allComposites)return a.cache.allComposites;for(var r=[].concat(a.composites),i=0;i<a.composites.length;i++)r=r.concat(e.allComposites(a.composites[i]));return a.cache&&(a.cache.allComposites=r),r},e.get=function(a,r,i){var t,l;switch(i){case"body":t=e.allBodies(a);break;case"constraint":t=e.allConstraints(a);break;case"composite":t=e.allComposites(a).concat(a);break}return t?(l=t.filter(function(f){return f.id.toString()===r.toString()}),l.length===0?null:l[0]):null},e.move=function(a,r,i){return e.remove(a,r),e.add(i,r),a},e.rebase=function(a){for(var r=e.allBodies(a).concat(e.allConstraints(a)).concat(e.allComposites(a)),i=0;i<r.length;i++)r[i].id=o.nextId();return a},e.translate=function(a,r,i){for(var t=i?e.allBodies(a):a.bodies,l=0;l<t.length;l++)c.translate(t[l],r);return a},e.rotate=function(a,r,i,t){for(var l=Math.cos(r),f=Math.sin(r),u=t?e.allBodies(a):a.bodies,x=0;x<u.length;x++){var S=u[x],C=S.position.x-i.x,M=S.position.y-i.y;c.setPosition(S,{x:i.x+(C*l-M*f),y:i.y+(C*f+M*l)}),c.rotate(S,r)}return a},e.scale=function(a,r,i,t,l){for(var f=l?e.allBodies(a):a.bodies,u=0;u<f.length;u++){var x=f[u],S=x.position.x-t.x,C=x.position.y-t.y;c.setPosition(x,{x:t.x+S*r,y:t.y+C*i}),c.scale(x,r,i)}return a},e.bounds=function(a){for(var r=e.allBodies(a),i=[],t=0;t<r.length;t+=1){var l=r[t];i.push(l.bounds.min,l.bounds.max)}return s.create(i)}})()},function(b,T,d){var e={};b.exports=e;var n=d(4),o=d(5),s=d(0);(function(){e._motionWakeThreshold=.18,e._motionSleepThreshold=.08,e._minBias=.9,e.update=function(c,a){for(var r=a/s._baseDelta,i=e._motionSleepThreshold,t=0;t<c.length;t++){var l=c[t],f=n.getSpeed(l),u=n.getAngularSpeed(l),x=f*f+u*u;if(l.force.x!==0||l.force.y!==0){e.set(l,!1);continue}var S=Math.min(l.motion,x),C=Math.max(l.motion,x);l.motion=e._minBias*S+(1-e._minBias)*C,l.sleepThreshold>0&&l.motion<i?(l.sleepCounter+=1,l.sleepCounter>=l.sleepThreshold/r&&e.set(l,!0)):l.sleepCounter>0&&(l.sleepCounter-=1)}},e.afterCollisions=function(c){for(var a=e._motionSleepThreshold,r=0;r<c.length;r++){var i=c[r];if(i.isActive){var t=i.collision,l=t.bodyA.parent,f=t.bodyB.parent;if(!(l.isSleeping&&f.isSleeping||l.isStatic||f.isStatic)&&(l.isSleeping||f.isSleeping)){var u=l.isSleeping&&!l.isStatic?l:f,x=u===l?f:l;!u.isStatic&&x.motion>a&&e.set(u,!1)}}}},e.set=function(c,a){var r=c.isSleeping;a?(c.isSleeping=!0,c.sleepCounter=c.sleepThreshold,c.positionImpulse.x=0,c.positionImpulse.y=0,c.positionPrev.x=c.position.x,c.positionPrev.y=c.position.y,c.anglePrev=c.angle,c.speed=0,c.angularSpeed=0,c.motion=0,r||o.trigger(c,"sleepStart")):(c.isSleeping=!1,c.sleepCounter=0,r&&o.trigger(c,"sleepEnd"))}})()},function(b,T,d){var e={};b.exports=e;var n=d(3),o=d(9);(function(){var s=[],c={overlap:0,axis:null},a={overlap:0,axis:null};e.create=function(r,i){return{pair:null,collided:!1,bodyA:r,bodyB:i,parentA:r.parent,parentB:i.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[null,null],supportCount:0}},e.collides=function(r,i,t){if(e._overlapAxes(c,r.vertices,i.vertices,r.axes),c.overlap<=0||(e._overlapAxes(a,i.vertices,r.vertices,i.axes),a.overlap<=0))return null;var l=t&&t.table[o.id(r,i)],f;l?f=l.collision:(f=e.create(r,i),f.collided=!0,f.bodyA=r.id<i.id?r:i,f.bodyB=r.id<i.id?i:r,f.parentA=f.bodyA.parent,f.parentB=f.bodyB.parent),r=f.bodyA,i=f.bodyB;var u;c.overlap<a.overlap?u=c:u=a;var x=f.normal,S=f.tangent,C=f.penetration,M=f.supports,p=u.overlap,g=u.axis,y=g.x,v=g.y,w=i.position.x-r.position.x,h=i.position.y-r.position.y;y*w+v*h>=0&&(y=-y,v=-v),x.x=y,x.y=v,S.x=-v,S.y=y,C.x=y*p,C.y=v*p,f.depth=p;var m=e._findSupports(r,i,x,1),P=0;if(n.contains(r.vertices,m[0])&&(M[P++]=m[0]),n.contains(r.vertices,m[1])&&(M[P++]=m[1]),P<2){var I=e._findSupports(i,r,x,-1);n.contains(i.vertices,I[0])&&(M[P++]=I[0]),P<2&&n.contains(i.vertices,I[1])&&(M[P++]=I[1])}return P===0&&(M[P++]=m[0]),f.supportCount=P,f},e._overlapAxes=function(r,i,t,l){var f=i.length,u=t.length,x=i[0].x,S=i[0].y,C=t[0].x,M=t[0].y,p=l.length,g=Number.MAX_VALUE,y=0,v,w,h,m,P,I;for(P=0;P<p;P++){var R=l[P],E=R.x,L=R.y,D=x*E+S*L,k=C*E+M*L,H=D,W=k;for(I=1;I<f;I+=1)m=i[I].x*E+i[I].y*L,m>H?H=m:m<D&&(D=m);for(I=1;I<u;I+=1)m=t[I].x*E+t[I].y*L,m>W?W=m:m<k&&(k=m);if(w=H-k,h=W-D,v=w<h?w:h,v<g&&(g=v,y=P,v<=0))break}r.axis=l[y],r.overlap=g},e._findSupports=function(r,i,t,l){var f=i.vertices,u=f.length,x=r.position.x,S=r.position.y,C=t.x*l,M=t.y*l,p=f[0],g=p,y=C*(x-g.x)+M*(S-g.y),v,w,h;for(h=1;h<u;h+=1)g=f[h],w=C*(x-g.x)+M*(S-g.y),w<y&&(y=w,p=g);return v=f[(u+p.index-1)%u],y=C*(x-v.x)+M*(S-v.y),g=f[(p.index+1)%u],C*(x-g.x)+M*(S-g.y)<y?(s[0]=p,s[1]=g,s):(s[0]=p,s[1]=v,s)}})()},function(b,T,d){var e={};b.exports=e;var n=d(16);(function(){e.create=function(o,s){var c=o.bodyA,a=o.bodyB,r={id:e.id(c,a),bodyA:c,bodyB:a,collision:o,contacts:[n.create(),n.create()],contactCount:0,separation:0,isActive:!0,isSensor:c.isSensor||a.isSensor,timeCreated:s,timeUpdated:s,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return e.update(r,o,s),r},e.update=function(o,s,c){var a=s.supports,r=s.supportCount,i=o.contacts,t=s.parentA,l=s.parentB;o.isActive=!0,o.timeUpdated=c,o.collision=s,o.separation=s.depth,o.inverseMass=t.inverseMass+l.inverseMass,o.friction=t.friction<l.friction?t.friction:l.friction,o.frictionStatic=t.frictionStatic>l.frictionStatic?t.frictionStatic:l.frictionStatic,o.restitution=t.restitution>l.restitution?t.restitution:l.restitution,o.slop=t.slop>l.slop?t.slop:l.slop,o.contactCount=r,s.pair=o;var f=a[0],u=i[0],x=a[1],S=i[1];(S.vertex===f||u.vertex===x)&&(i[1]=u,i[0]=u=S,S=i[1]),u.vertex=f,S.vertex=x},e.setActive=function(o,s,c){s?(o.isActive=!0,o.timeUpdated=c):(o.isActive=!1,o.contactCount=0)},e.id=function(o,s){return o.id<s.id?o.id.toString(36)+":"+s.id.toString(36):s.id.toString(36)+":"+o.id.toString(36)}})()},function(b,T,d){var e={};b.exports=e;var n=d(3),o=d(2),s=d(7),c=d(1),a=d(11),r=d(0);(function(){e._warming=.4,e._torqueDampen=1,e._minLength=1e-6,e.create=function(i){var t=i;t.bodyA&&!t.pointA&&(t.pointA={x:0,y:0}),t.bodyB&&!t.pointB&&(t.pointB={x:0,y:0});var l=t.bodyA?o.add(t.bodyA.position,t.pointA):t.pointA,f=t.bodyB?o.add(t.bodyB.position,t.pointB):t.pointB,u=o.magnitude(o.sub(l,f));t.length=typeof t.length<"u"?t.length:u,t.id=t.id||r.nextId(),t.label=t.label||"Constraint",t.type="constraint",t.stiffness=t.stiffness||(t.length>0?1:.7),t.damping=t.damping||0,t.angularStiffness=t.angularStiffness||0,t.angleA=t.bodyA?t.bodyA.angle:t.angleA,t.angleB=t.bodyB?t.bodyB.angle:t.angleB,t.plugin={};var x={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return t.length===0&&t.stiffness>.1?(x.type="pin",x.anchors=!1):t.stiffness<.9&&(x.type="spring"),t.render=r.extend(x,t.render),t},e.preSolveAll=function(i){for(var t=0;t<i.length;t+=1){var l=i[t],f=l.constraintImpulse;l.isStatic||f.x===0&&f.y===0&&f.angle===0||(l.position.x+=f.x,l.position.y+=f.y,l.angle+=f.angle)}},e.solveAll=function(i,t){for(var l=r.clamp(t/r._baseDelta,0,1),f=0;f<i.length;f+=1){var u=i[f],x=!u.bodyA||u.bodyA&&u.bodyA.isStatic,S=!u.bodyB||u.bodyB&&u.bodyB.isStatic;(x||S)&&e.solve(i[f],l)}for(f=0;f<i.length;f+=1)u=i[f],x=!u.bodyA||u.bodyA&&u.bodyA.isStatic,S=!u.bodyB||u.bodyB&&u.bodyB.isStatic,!x&&!S&&e.solve(i[f],l)},e.solve=function(i,t){var l=i.bodyA,f=i.bodyB,u=i.pointA,x=i.pointB;if(!(!l&&!f)){l&&!l.isStatic&&(o.rotate(u,l.angle-i.angleA,u),i.angleA=l.angle),f&&!f.isStatic&&(o.rotate(x,f.angle-i.angleB,x),i.angleB=f.angle);var S=u,C=x;if(l&&(S=o.add(l.position,u)),f&&(C=o.add(f.position,x)),!(!S||!C)){var M=o.sub(S,C),p=o.magnitude(M);p<e._minLength&&(p=e._minLength);var g=(p-i.length)/p,y=i.stiffness>=1||i.length===0,v=y?i.stiffness*t:i.stiffness*t*t,w=i.damping*t,h=o.mult(M,g*v),m=(l?l.inverseMass:0)+(f?f.inverseMass:0),P=(l?l.inverseInertia:0)+(f?f.inverseInertia:0),I=m+P,R,E,L,D,k;if(w>0){var H=o.create();L=o.div(M,p),k=o.sub(f&&o.sub(f.position,f.positionPrev)||H,l&&o.sub(l.position,l.positionPrev)||H),D=o.dot(L,k)}l&&!l.isStatic&&(E=l.inverseMass/m,l.constraintImpulse.x-=h.x*E,l.constraintImpulse.y-=h.y*E,l.position.x-=h.x*E,l.position.y-=h.y*E,w>0&&(l.positionPrev.x-=w*L.x*D*E,l.positionPrev.y-=w*L.y*D*E),R=o.cross(u,h)/I*e._torqueDampen*l.inverseInertia*(1-i.angularStiffness),l.constraintImpulse.angle-=R,l.angle-=R),f&&!f.isStatic&&(E=f.inverseMass/m,f.constraintImpulse.x+=h.x*E,f.constraintImpulse.y+=h.y*E,f.position.x+=h.x*E,f.position.y+=h.y*E,w>0&&(f.positionPrev.x+=w*L.x*D*E,f.positionPrev.y+=w*L.y*D*E),R=o.cross(x,h)/I*e._torqueDampen*f.inverseInertia*(1-i.angularStiffness),f.constraintImpulse.angle+=R,f.angle+=R)}}},e.postSolveAll=function(i){for(var t=0;t<i.length;t++){var l=i[t],f=l.constraintImpulse;if(!(l.isStatic||f.x===0&&f.y===0&&f.angle===0)){s.set(l,!1);for(var u=0;u<l.parts.length;u++){var x=l.parts[u];n.translate(x.vertices,f),u>0&&(x.position.x+=f.x,x.position.y+=f.y),f.angle!==0&&(n.rotate(x.vertices,f.angle,l.position),a.rotate(x.axes,f.angle),u>0&&o.rotateAbout(x.position,f.angle,l.position,x.position)),c.update(x.bounds,x.vertices,l.velocity)}f.angle*=e._warming,f.x*=e._warming,f.y*=e._warming}}},e.pointAWorld=function(i){return{x:(i.bodyA?i.bodyA.position.x:0)+(i.pointA?i.pointA.x:0),y:(i.bodyA?i.bodyA.position.y:0)+(i.pointA?i.pointA.y:0)}},e.pointBWorld=function(i){return{x:(i.bodyB?i.bodyB.position.x:0)+(i.pointB?i.pointB.x:0),y:(i.bodyB?i.bodyB.position.y:0)+(i.pointB?i.pointB.y:0)}},e.currentLength=function(i){var t=(i.bodyA?i.bodyA.position.x:0)+(i.pointA?i.pointA.x:0),l=(i.bodyA?i.bodyA.position.y:0)+(i.pointA?i.pointA.y:0),f=(i.bodyB?i.bodyB.position.x:0)+(i.pointB?i.pointB.x:0),u=(i.bodyB?i.bodyB.position.y:0)+(i.pointB?i.pointB.y:0),x=t-f,S=l-u;return Math.sqrt(x*x+S*S)}})()},function(b,T,d){var e={};b.exports=e;var n=d(2),o=d(0);(function(){e.fromVertices=function(s){for(var c={},a=0;a<s.length;a++){var r=(a+1)%s.length,i=n.normalise({x:s[r].y-s[a].y,y:s[a].x-s[r].x}),t=i.y===0?1/0:i.x/i.y;t=t.toFixed(3).toString(),c[t]=i}return o.values(c)},e.rotate=function(s,c){if(c!==0)for(var a=Math.cos(c),r=Math.sin(c),i=0;i<s.length;i++){var t=s[i],l;l=t.x*a-t.y*r,t.y=t.x*r+t.y*a,t.x=l}}})()},function(b,T,d){var e={};b.exports=e;var n=d(3),o=d(0),s=d(4),c=d(1),a=d(2);(function(){e.rectangle=function(r,i,t,l,f){f=f||{};var u={label:"Rectangle Body",position:{x:r,y:i},vertices:n.fromPath("L 0 0 L "+t+" 0 L "+t+" "+l+" L 0 "+l)};if(f.chamfer){var x=f.chamfer;u.vertices=n.chamfer(u.vertices,x.radius,x.quality,x.qualityMin,x.qualityMax),delete f.chamfer}return s.create(o.extend({},u,f))},e.trapezoid=function(r,i,t,l,f,u){u=u||{},f>=1&&o.warn("Bodies.trapezoid: slope parameter must be < 1."),f*=.5;var x=(1-f*2)*t,S=t*f,C=S+x,M=C+S,p;f<.5?p="L 0 0 L "+S+" "+-l+" L "+C+" "+-l+" L "+M+" 0":p="L 0 0 L "+C+" "+-l+" L "+M+" 0";var g={label:"Trapezoid Body",position:{x:r,y:i},vertices:n.fromPath(p)};if(u.chamfer){var y=u.chamfer;g.vertices=n.chamfer(g.vertices,y.radius,y.quality,y.qualityMin,y.qualityMax),delete u.chamfer}return s.create(o.extend({},g,u))},e.circle=function(r,i,t,l,f){l=l||{};var u={label:"Circle Body",circleRadius:t};f=f||25;var x=Math.ceil(Math.max(10,Math.min(f,t)));return x%2===1&&(x+=1),e.polygon(r,i,x,t,o.extend({},u,l))},e.polygon=function(r,i,t,l,f){if(f=f||{},t<3)return e.circle(r,i,l,f);for(var u=2*Math.PI/t,x="",S=u*.5,C=0;C<t;C+=1){var M=S+C*u,p=Math.cos(M)*l,g=Math.sin(M)*l;x+="L "+p.toFixed(3)+" "+g.toFixed(3)+" "}var y={label:"Polygon Body",position:{x:r,y:i},vertices:n.fromPath(x)};if(f.chamfer){var v=f.chamfer;y.vertices=n.chamfer(y.vertices,v.radius,v.quality,v.qualityMin,v.qualityMax),delete f.chamfer}return s.create(o.extend({},y,f))},e.fromVertices=function(r,i,t,l,f,u,x,S){var C=o.getDecomp(),M,p,g,y,v,w,h,m,P,I,R;for(M=!!(C&&C.quickDecomp),l=l||{},g=[],f=typeof f<"u"?f:!1,u=typeof u<"u"?u:.01,x=typeof x<"u"?x:10,S=typeof S<"u"?S:.01,o.isArray(t[0])||(t=[t]),I=0;I<t.length;I+=1)if(w=t[I],y=n.isConvex(w),v=!y,v&&!M&&o.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),y||!M)y?w=n.clockwiseSort(w):w=n.hull(w),g.push({position:{x:r,y:i},vertices:w});else{var E=w.map(function($){return[$.x,$.y]});C.makeCCW(E),u!==!1&&C.removeCollinearPoints(E,u),S!==!1&&C.removeDuplicatePoints&&C.removeDuplicatePoints(E,S);var L=C.quickDecomp(E);for(h=0;h<L.length;h++){var D=L[h],k=D.map(function($){return{x:$[0],y:$[1]}});x>0&&n.area(k)<x||g.push({position:n.centre(k),vertices:k})}}for(h=0;h<g.length;h++)g[h]=s.create(o.extend(g[h],l));if(f){var H=5;for(h=0;h<g.length;h++){var W=g[h];for(m=h+1;m<g.length;m++){var V=g[m];if(c.overlaps(W.bounds,V.bounds)){var U=W.vertices,N=V.vertices;for(P=0;P<W.vertices.length;P++)for(R=0;R<V.vertices.length;R++){var K=a.magnitudeSquared(a.sub(U[(P+1)%U.length],N[R])),J=a.magnitudeSquared(a.sub(U[P],N[(R+1)%N.length]));K<H&&J<H&&(U[P].isInternal=!0,N[R].isInternal=!0)}}}}}return g.length>1?(p=s.create(o.extend({parts:g.slice(0)},l)),s.setPosition(p,{x:r,y:i}),p):g[0]}})()},function(b,T,d){var e={};b.exports=e;var n=d(0),o=d(8);(function(){e.create=function(s){var c={bodies:[],collisions:[],pairs:null};return n.extend(c,s)},e.setBodies=function(s,c){s.bodies=c.slice(0)},e.clear=function(s){s.bodies=[],s.collisions=[]},e.collisions=function(s){var c=s.pairs,a=s.bodies,r=a.length,i=e.canCollide,t=o.collides,l=s.collisions,f=0,u,x;for(a.sort(e._compareBoundsX),u=0;u<r;u++){var S=a[u],C=S.bounds,M=S.bounds.max.x,p=S.bounds.max.y,g=S.bounds.min.y,y=S.isStatic||S.isSleeping,v=S.parts.length,w=v===1;for(x=u+1;x<r;x++){var h=a[x],m=h.bounds;if(m.min.x>M)break;if(!(p<m.min.y||g>m.max.y)&&!(y&&(h.isStatic||h.isSleeping))&&i(S.collisionFilter,h.collisionFilter)){var P=h.parts.length;if(w&&P===1){var I=t(S,h,c);I&&(l[f++]=I)}else for(var R=v>1?1:0,E=P>1?1:0,L=R;L<v;L++)for(var D=S.parts[L],C=D.bounds,k=E;k<P;k++){var H=h.parts[k],m=H.bounds;if(!(C.min.x>m.max.x||C.max.x<m.min.x||C.max.y<m.min.y||C.min.y>m.max.y)){var I=t(D,H,c);I&&(l[f++]=I)}}}}}return l.length!==f&&(l.length=f),l},e.canCollide=function(s,c){return s.group===c.group&&s.group!==0?s.group>0:(s.mask&c.category)!==0&&(c.mask&s.category)!==0},e._compareBoundsX=function(s,c){return s.bounds.min.x-c.bounds.min.x}})()},function(b,T,d){var e={};b.exports=e;var n=d(0);(function(){e.create=function(o){var s={};return o||n.log("Mouse.create: element was undefined, defaulting to document.body","warn"),s.element=o||document.body,s.absolute={x:0,y:0},s.position={x:0,y:0},s.mousedownPosition={x:0,y:0},s.mouseupPosition={x:0,y:0},s.offset={x:0,y:0},s.scale={x:1,y:1},s.wheelDelta=0,s.button=-1,s.pixelRatio=parseInt(s.element.getAttribute("data-pixel-ratio"),10)||1,s.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},s.mousemove=function(c){var a=e._getRelativeMousePosition(c,s.element,s.pixelRatio),r=c.changedTouches;r&&(s.button=0,c.preventDefault()),s.absolute.x=a.x,s.absolute.y=a.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.sourceEvents.mousemove=c},s.mousedown=function(c){var a=e._getRelativeMousePosition(c,s.element,s.pixelRatio),r=c.changedTouches;r?(s.button=0,c.preventDefault()):s.button=c.button,s.absolute.x=a.x,s.absolute.y=a.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.mousedownPosition.x=s.position.x,s.mousedownPosition.y=s.position.y,s.sourceEvents.mousedown=c},s.mouseup=function(c){var a=e._getRelativeMousePosition(c,s.element,s.pixelRatio),r=c.changedTouches;r&&c.preventDefault(),s.button=-1,s.absolute.x=a.x,s.absolute.y=a.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.mouseupPosition.x=s.position.x,s.mouseupPosition.y=s.position.y,s.sourceEvents.mouseup=c},s.mousewheel=function(c){s.wheelDelta=Math.max(-1,Math.min(1,c.wheelDelta||-c.detail)),c.preventDefault(),s.sourceEvents.mousewheel=c},e.setElement(s,s.element),s},e.setElement=function(o,s){o.element=s,s.addEventListener("mousemove",o.mousemove,{passive:!0}),s.addEventListener("mousedown",o.mousedown,{passive:!0}),s.addEventListener("mouseup",o.mouseup,{passive:!0}),s.addEventListener("wheel",o.mousewheel,{passive:!1}),s.addEventListener("touchmove",o.mousemove,{passive:!1}),s.addEventListener("touchstart",o.mousedown,{passive:!1}),s.addEventListener("touchend",o.mouseup,{passive:!1})},e.clearSourceEvents=function(o){o.sourceEvents.mousemove=null,o.sourceEvents.mousedown=null,o.sourceEvents.mouseup=null,o.sourceEvents.mousewheel=null,o.wheelDelta=0},e.setOffset=function(o,s){o.offset.x=s.x,o.offset.y=s.y,o.position.x=o.absolute.x*o.scale.x+o.offset.x,o.position.y=o.absolute.y*o.scale.y+o.offset.y},e.setScale=function(o,s){o.scale.x=s.x,o.scale.y=s.y,o.position.x=o.absolute.x*o.scale.x+o.offset.x,o.position.y=o.absolute.y*o.scale.y+o.offset.y},e._getRelativeMousePosition=function(o,s,c){var a=s.getBoundingClientRect(),r=document.documentElement||document.body.parentNode||document.body,i=window.pageXOffset!==void 0?window.pageXOffset:r.scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:r.scrollTop,l=o.changedTouches,f,u;return l?(f=l[0].pageX-a.left-i,u=l[0].pageY-a.top-t):(f=o.pageX-a.left-i,u=o.pageY-a.top-t),{x:f/(s.clientWidth/(s.width||s.clientWidth)*c),y:u/(s.clientHeight/(s.height||s.clientHeight)*c)}}})()},function(b,T,d){var e={};b.exports=e;var n=d(0);(function(){e._registry={},e.register=function(o){if(e.isPlugin(o)||n.warn("Plugin.register:",e.toString(o),"does not implement all required fields."),o.name in e._registry){var s=e._registry[o.name],c=e.versionParse(o.version).number,a=e.versionParse(s.version).number;c>a?(n.warn("Plugin.register:",e.toString(s),"was upgraded to",e.toString(o)),e._registry[o.name]=o):c<a?n.warn("Plugin.register:",e.toString(s),"can not be downgraded to",e.toString(o)):o!==s&&n.warn("Plugin.register:",e.toString(o),"is already registered to different plugin object")}else e._registry[o.name]=o;return o},e.resolve=function(o){return e._registry[e.dependencyParse(o).name]},e.toString=function(o){return typeof o=="string"?o:(o.name||"anonymous")+"@"+(o.version||o.range||"0.0.0")},e.isPlugin=function(o){return o&&o.name&&o.version&&o.install},e.isUsed=function(o,s){return o.used.indexOf(s)>-1},e.isFor=function(o,s){var c=o.for&&e.dependencyParse(o.for);return!o.for||s.name===c.name&&e.versionSatisfies(s.version,c.range)},e.use=function(o,s){if(o.uses=(o.uses||[]).concat(s||[]),o.uses.length===0){n.warn("Plugin.use:",e.toString(o),"does not specify any dependencies to install.");return}for(var c=e.dependencies(o),a=n.topologicalSort(c),r=[],i=0;i<a.length;i+=1)if(a[i]!==o.name){var t=e.resolve(a[i]);if(!t){r.push("âŒ "+a[i]);continue}e.isUsed(o,t.name)||(e.isFor(t,o)||(n.warn("Plugin.use:",e.toString(t),"is for",t.for,"but installed on",e.toString(o)+"."),t._warned=!0),t.install?t.install(o):(n.warn("Plugin.use:",e.toString(t),"does not specify an install function."),t._warned=!0),t._warned?(r.push("ðŸ”¶ "+e.toString(t)),delete t._warned):r.push("âœ… "+e.toString(t)),o.used.push(t.name))}r.length>0&&n.info(r.join("  "))},e.dependencies=function(o,s){var c=e.dependencyParse(o),a=c.name;if(s=s||{},!(a in s)){o=e.resolve(o)||o,s[a]=n.map(o.uses||[],function(i){e.isPlugin(i)&&e.register(i);var t=e.dependencyParse(i),l=e.resolve(i);return l&&!e.versionSatisfies(l.version,t.range)?(n.warn("Plugin.dependencies:",e.toString(l),"does not satisfy",e.toString(t),"used by",e.toString(c)+"."),l._warned=!0,o._warned=!0):l||(n.warn("Plugin.dependencies:",e.toString(i),"used by",e.toString(c),"could not be resolved."),o._warned=!0),t.name});for(var r=0;r<s[a].length;r+=1)e.dependencies(s[a][r],s);return s}},e.dependencyParse=function(o){if(n.isString(o)){var s=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/;return s.test(o)||n.warn("Plugin.dependencyParse:",o,"is not a valid dependency string."),{name:o.split("@")[0],range:o.split("@")[1]||"*"}}return{name:o.name,range:o.range||o.version}},e.versionParse=function(o){var s=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;s.test(o)||n.warn("Plugin.versionParse:",o,"is not a valid version or range.");var c=s.exec(o),a=Number(c[4]),r=Number(c[5]),i=Number(c[6]);return{isRange:!!(c[1]||c[2]),version:c[3],range:o,operator:c[1]||c[2]||"",major:a,minor:r,patch:i,parts:[a,r,i],prerelease:c[7],number:a*1e8+r*1e4+i}},e.versionSatisfies=function(o,s){s=s||"*";var c=e.versionParse(s),a=e.versionParse(o);if(c.isRange){if(c.operator==="*"||o==="*")return!0;if(c.operator===">")return a.number>c.number;if(c.operator===">=")return a.number>=c.number;if(c.operator==="~")return a.major===c.major&&a.minor===c.minor&&a.patch>=c.patch;if(c.operator==="^")return c.major>0?a.major===c.major&&a.number>=c.number:c.minor>0?a.minor===c.minor&&a.patch>=c.patch:a.patch===c.patch}return o===s||o==="*"}})()},function(b,T){var d={};b.exports=d,function(){d.create=function(e){return{vertex:e,normalImpulse:0,tangentImpulse:0}}}()},function(b,T,d){var e={};b.exports=e;var n=d(7),o=d(18),s=d(13),c=d(19),a=d(5),r=d(6),i=d(10),t=d(0),l=d(4);(function(){e._deltaMax=1e3/60,e.create=function(f){f=f||{};var u={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0,lastUpdatesPerFrame:0}},x=t.extend(u,f);return x.world=f.world||r.create({label:"World"}),x.pairs=f.pairs||c.create(),x.detector=f.detector||s.create(),x.detector.pairs=x.pairs,x.grid={buckets:[]},x.world.gravity=x.gravity,x.broadphase=x.grid,x.metrics={},x},e.update=function(f,u){var x=t.now(),S=f.world,C=f.detector,M=f.pairs,p=f.timing,g=p.timestamp,y;u>e._deltaMax&&t.warnOnce("Matter.Engine.update: delta argument is recommended to be less than or equal to",e._deltaMax.toFixed(3),"ms."),u=typeof u<"u"?u:t._baseDelta,u*=p.timeScale,p.timestamp+=u,p.lastDelta=u;var v={timestamp:p.timestamp,delta:u};a.trigger(f,"beforeUpdate",v);var w=r.allBodies(S),h=r.allConstraints(S);for(S.isModified&&(s.setBodies(C,w),r.setModified(S,!1,!1,!0)),f.enableSleeping&&n.update(w,u),e._bodiesApplyGravity(w,f.gravity),u>0&&e._bodiesUpdate(w,u),a.trigger(f,"beforeSolve",v),i.preSolveAll(w),y=0;y<f.constraintIterations;y++)i.solveAll(h,u);i.postSolveAll(w);var m=s.collisions(C);c.update(M,m,g),f.enableSleeping&&n.afterCollisions(M.list),M.collisionStart.length>0&&a.trigger(f,"collisionStart",{pairs:M.collisionStart,timestamp:p.timestamp,delta:u});var P=t.clamp(20/f.positionIterations,0,1);for(o.preSolvePosition(M.list),y=0;y<f.positionIterations;y++)o.solvePosition(M.list,u,P);for(o.postSolvePosition(w),i.preSolveAll(w),y=0;y<f.constraintIterations;y++)i.solveAll(h,u);for(i.postSolveAll(w),o.preSolveVelocity(M.list),y=0;y<f.velocityIterations;y++)o.solveVelocity(M.list,u);return e._bodiesUpdateVelocities(w),M.collisionActive.length>0&&a.trigger(f,"collisionActive",{pairs:M.collisionActive,timestamp:p.timestamp,delta:u}),M.collisionEnd.length>0&&a.trigger(f,"collisionEnd",{pairs:M.collisionEnd,timestamp:p.timestamp,delta:u}),e._bodiesClearForces(w),a.trigger(f,"afterUpdate",v),f.timing.lastElapsed=t.now()-x,f},e.merge=function(f,u){if(t.extend(f,u),u.world){f.world=u.world,e.clear(f);for(var x=r.allBodies(f.world),S=0;S<x.length;S++){var C=x[S];n.set(C,!1),C.id=t.nextId()}}},e.clear=function(f){c.clear(f.pairs),s.clear(f.detector)},e._bodiesClearForces=function(f){for(var u=f.length,x=0;x<u;x++){var S=f[x];S.force.x=0,S.force.y=0,S.torque=0}},e._bodiesApplyGravity=function(f,u){var x=typeof u.scale<"u"?u.scale:.001,S=f.length;if(!(u.x===0&&u.y===0||x===0))for(var C=0;C<S;C++){var M=f[C];M.isStatic||M.isSleeping||(M.force.y+=M.mass*u.y*x,M.force.x+=M.mass*u.x*x)}},e._bodiesUpdate=function(f,u){for(var x=f.length,S=0;S<x;S++){var C=f[S];C.isStatic||C.isSleeping||l.update(C,u)}},e._bodiesUpdateVelocities=function(f){for(var u=f.length,x=0;x<u;x++)l.updateVelocities(f[x])}})()},function(b,T,d){var e={};b.exports=e;var n=d(3),o=d(0),s=d(1);(function(){e._restingThresh=2,e._restingThreshTangent=Math.sqrt(6),e._positionDampen=.9,e._positionWarming=.8,e._frictionNormalMultiplier=5,e._frictionMaxStatic=Number.MAX_VALUE,e.preSolvePosition=function(c){var a,r,i,t=c.length;for(a=0;a<t;a++)r=c[a],r.isActive&&(i=r.contactCount,r.collision.parentA.totalContacts+=i,r.collision.parentB.totalContacts+=i)},e.solvePosition=function(c,a,r){var i,t,l,f,u,x,S,C,M=e._positionDampen*(r||1),p=o.clamp(a/o._baseDelta,0,1),g=c.length;for(i=0;i<g;i++)t=c[i],!(!t.isActive||t.isSensor)&&(l=t.collision,f=l.parentA,u=l.parentB,x=l.normal,t.separation=l.depth+x.x*(u.positionImpulse.x-f.positionImpulse.x)+x.y*(u.positionImpulse.y-f.positionImpulse.y));for(i=0;i<g;i++)t=c[i],!(!t.isActive||t.isSensor)&&(l=t.collision,f=l.parentA,u=l.parentB,x=l.normal,C=t.separation-t.slop*p,(f.isStatic||u.isStatic)&&(C*=2),f.isStatic||f.isSleeping||(S=M/f.totalContacts,f.positionImpulse.x+=x.x*C*S,f.positionImpulse.y+=x.y*C*S),u.isStatic||u.isSleeping||(S=M/u.totalContacts,u.positionImpulse.x-=x.x*C*S,u.positionImpulse.y-=x.y*C*S))},e.postSolvePosition=function(c){for(var a=e._positionWarming,r=c.length,i=n.translate,t=s.update,l=0;l<r;l++){var f=c[l],u=f.positionImpulse,x=u.x,S=u.y,C=f.velocity;if(f.totalContacts=0,x!==0||S!==0){for(var M=0;M<f.parts.length;M++){var p=f.parts[M];i(p.vertices,u),t(p.bounds,p.vertices,C),p.position.x+=x,p.position.y+=S}f.positionPrev.x+=x,f.positionPrev.y+=S,x*C.x+S*C.y<0?(u.x=0,u.y=0):(u.x*=a,u.y*=a)}}},e.preSolveVelocity=function(c){var a=c.length,r,i;for(r=0;r<a;r++){var t=c[r];if(!(!t.isActive||t.isSensor)){var l=t.contacts,f=t.contactCount,u=t.collision,x=u.parentA,S=u.parentB,C=u.normal,M=u.tangent;for(i=0;i<f;i++){var p=l[i],g=p.vertex,y=p.normalImpulse,v=p.tangentImpulse;if(y!==0||v!==0){var w=C.x*y+M.x*v,h=C.y*y+M.y*v;x.isStatic||x.isSleeping||(x.positionPrev.x+=w*x.inverseMass,x.positionPrev.y+=h*x.inverseMass,x.anglePrev+=x.inverseInertia*((g.x-x.position.x)*h-(g.y-x.position.y)*w)),S.isStatic||S.isSleeping||(S.positionPrev.x-=w*S.inverseMass,S.positionPrev.y-=h*S.inverseMass,S.anglePrev-=S.inverseInertia*((g.x-S.position.x)*h-(g.y-S.position.y)*w))}}}}},e.solveVelocity=function(c,a){var r=a/o._baseDelta,i=r*r,t=i*r,l=-e._restingThresh*r,f=e._restingThreshTangent,u=e._frictionNormalMultiplier*r,x=e._frictionMaxStatic,S=c.length,C,M,p,g;for(p=0;p<S;p++){var y=c[p];if(!(!y.isActive||y.isSensor)){var v=y.collision,w=v.parentA,h=v.parentB,m=v.normal.x,P=v.normal.y,I=v.tangent.x,R=v.tangent.y,E=y.inverseMass,L=y.friction*y.frictionStatic*u,D=y.contacts,k=y.contactCount,H=1/k,W=w.position.x-w.positionPrev.x,V=w.position.y-w.positionPrev.y,U=w.angle-w.anglePrev,N=h.position.x-h.positionPrev.x,K=h.position.y-h.positionPrev.y,J=h.angle-h.anglePrev;for(g=0;g<k;g++){var $=D[g],q=$.vertex,X=q.x-w.position.x,fe=q.y-w.position.y,j=q.x-h.position.x,_=q.y-h.position.y,Y=W-fe*U,We=V+X*U,Ve=N-_*J,Ue=K+j*J,be=Y-Ve,Te=We-Ue,pe=m*be+P*Te,ee=I*be+R*Te,Ae=y.separation+pe,xe=Math.min(Ae,1);xe=Ae<0?0:xe;var Ie=xe*L;ee<-Ie||ee>Ie?(M=ee>0?ee:-ee,C=y.friction*(ee>0?1:-1)*t,C<-M?C=-M:C>M&&(C=M)):(C=ee,M=x);var Be=X*P-fe*m,Ee=j*P-_*m,Re=H/(E+w.inverseInertia*Be*Be+h.inverseInertia*Ee*Ee),ce=(1+y.restitution)*pe*Re;if(C*=Re,pe<l)$.normalImpulse=0;else{var Ne=$.normalImpulse;$.normalImpulse+=ce,$.normalImpulse>0&&($.normalImpulse=0),ce=$.normalImpulse-Ne}if(ee<-f||ee>f)$.tangentImpulse=0;else{var Xe=$.tangentImpulse;$.tangentImpulse+=C,$.tangentImpulse<-M&&($.tangentImpulse=-M),$.tangentImpulse>M&&($.tangentImpulse=M),C=$.tangentImpulse-Xe}var ue=m*ce+I*C,de=P*ce+R*C;w.isStatic||w.isSleeping||(w.positionPrev.x+=ue*w.inverseMass,w.positionPrev.y+=de*w.inverseMass,w.anglePrev+=(X*de-fe*ue)*w.inverseInertia),h.isStatic||h.isSleeping||(h.positionPrev.x-=ue*h.inverseMass,h.positionPrev.y-=de*h.inverseMass,h.anglePrev-=(j*de-_*ue)*h.inverseInertia)}}}}})()},function(b,T,d){var e={};b.exports=e;var n=d(9),o=d(0);(function(){e.create=function(s){return o.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},s)},e.update=function(s,c,a){var r=n.update,i=n.create,t=n.setActive,l=s.table,f=s.list,u=f.length,x=u,S=s.collisionStart,C=s.collisionEnd,M=s.collisionActive,p=c.length,g=0,y=0,v=0,w,h,m;for(m=0;m<p;m++)w=c[m],h=w.pair,h?(h.isActive&&(M[v++]=h),r(h,w,a)):(h=i(w,a),l[h.id]=h,S[g++]=h,f[x++]=h);for(x=0,u=f.length,m=0;m<u;m++)h=f[m],h.timeUpdated>=a?f[x++]=h:(t(h,!1,a),h.collision.bodyA.sleepCounter>0&&h.collision.bodyB.sleepCounter>0?f[x++]=h:(C[y++]=h,delete l[h.id]));f.length!==x&&(f.length=x),S.length!==g&&(S.length=g),C.length!==y&&(C.length=y),M.length!==v&&(M.length=v)},e.clear=function(s){return s.table={},s.list.length=0,s.collisionStart.length=0,s.collisionActive.length=0,s.collisionEnd.length=0,s}})()},function(b,T,d){var e=b.exports=d(21);e.Axes=d(11),e.Bodies=d(12),e.Body=d(4),e.Bounds=d(1),e.Collision=d(8),e.Common=d(0),e.Composite=d(6),e.Composites=d(22),e.Constraint=d(10),e.Contact=d(16),e.Detector=d(13),e.Engine=d(17),e.Events=d(5),e.Grid=d(23),e.Mouse=d(14),e.MouseConstraint=d(24),e.Pair=d(9),e.Pairs=d(19),e.Plugin=d(15),e.Query=d(25),e.Render=d(26),e.Resolver=d(18),e.Runner=d(27),e.SAT=d(28),e.Sleeping=d(7),e.Svg=d(29),e.Vector=d(2),e.Vertices=d(3),e.World=d(30),e.Engine.run=e.Runner.run,e.Common.deprecated(e.Engine,"run","Engine.run âž¤ use Matter.Runner.run(engine) instead")},function(b,T,d){var e={};b.exports=e;var n=d(15),o=d(0);(function(){e.name="matter-js",e.version="0.20.0",e.uses=[],e.used=[],e.use=function(){n.use(e,Array.prototype.slice.call(arguments))},e.before=function(s,c){return s=s.replace(/^Matter./,""),o.chainPathBefore(e,s,c)},e.after=function(s,c){return s=s.replace(/^Matter./,""),o.chainPathAfter(e,s,c)}})()},function(b,T,d){var e={};b.exports=e;var n=d(6),o=d(10),s=d(0),c=d(4),a=d(12),r=s.deprecated;(function(){e.stack=function(i,t,l,f,u,x,S){for(var C=n.create({label:"Stack"}),M=i,p=t,g,y=0,v=0;v<f;v++){for(var w=0,h=0;h<l;h++){var m=S(M,p,h,v,g,y);if(m){var P=m.bounds.max.y-m.bounds.min.y,I=m.bounds.max.x-m.bounds.min.x;P>w&&(w=P),c.translate(m,{x:I*.5,y:P*.5}),M=m.bounds.max.x+u,n.addBody(C,m),g=m,y+=1}else M+=u}p+=w+x,M=i}return C},e.chain=function(i,t,l,f,u,x){for(var S=i.bodies,C=1;C<S.length;C++){var M=S[C-1],p=S[C],g=M.bounds.max.y-M.bounds.min.y,y=M.bounds.max.x-M.bounds.min.x,v=p.bounds.max.y-p.bounds.min.y,w=p.bounds.max.x-p.bounds.min.x,h={bodyA:M,pointA:{x:y*t,y:g*l},bodyB:p,pointB:{x:w*f,y:v*u}},m=s.extend(h,x);n.addConstraint(i,o.create(m))}return i.label+=" Chain",i},e.mesh=function(i,t,l,f,u){var x=i.bodies,S,C,M,p,g;for(S=0;S<l;S++){for(C=1;C<t;C++)M=x[C-1+S*t],p=x[C+S*t],n.addConstraint(i,o.create(s.extend({bodyA:M,bodyB:p},u)));if(S>0)for(C=0;C<t;C++)M=x[C+(S-1)*t],p=x[C+S*t],n.addConstraint(i,o.create(s.extend({bodyA:M,bodyB:p},u))),f&&C>0&&(g=x[C-1+(S-1)*t],n.addConstraint(i,o.create(s.extend({bodyA:g,bodyB:p},u)))),f&&C<t-1&&(g=x[C+1+(S-1)*t],n.addConstraint(i,o.create(s.extend({bodyA:g,bodyB:p},u))))}return i.label+=" Mesh",i},e.pyramid=function(i,t,l,f,u,x,S){return e.stack(i,t,l,f,u,x,function(C,M,p,g,y,v){var w=Math.min(f,Math.ceil(l/2)),h=y?y.bounds.max.x-y.bounds.min.x:0;if(!(g>w)){g=w-g;var m=g,P=l-1-g;if(!(p<m||p>P)){v===1&&c.translate(y,{x:(p+(l%2===1?1:-1))*h,y:0});var I=y?p*h:0;return S(i+I+p*u,M,p,g,y,v)}}})},e.newtonsCradle=function(i,t,l,f,u){for(var x=n.create({label:"Newtons Cradle"}),S=0;S<l;S++){var C=1.9,M=a.circle(i+S*(f*C),t+u,f,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),p=o.create({pointA:{x:i+S*(f*C),y:t},bodyB:M});n.addBody(x,M),n.addConstraint(x,p)}return x},r(e,"newtonsCradle","Composites.newtonsCradle âž¤ moved to newtonsCradle example"),e.car=function(i,t,l,f,u){var x=c.nextGroup(!0),S=20,C=-l*.5+S,M=l*.5-S,p=0,g=n.create({label:"Car"}),y=a.rectangle(i,t,l,f,{collisionFilter:{group:x},chamfer:{radius:f*.5},density:2e-4}),v=a.circle(i+C,t+p,u,{collisionFilter:{group:x},friction:.8}),w=a.circle(i+M,t+p,u,{collisionFilter:{group:x},friction:.8}),h=o.create({bodyB:y,pointB:{x:C,y:p},bodyA:v,stiffness:1,length:0}),m=o.create({bodyB:y,pointB:{x:M,y:p},bodyA:w,stiffness:1,length:0});return n.addBody(g,y),n.addBody(g,v),n.addBody(g,w),n.addConstraint(g,h),n.addConstraint(g,m),g},r(e,"car","Composites.car âž¤ moved to car example"),e.softBody=function(i,t,l,f,u,x,S,C,M,p){M=s.extend({inertia:1/0},M),p=s.extend({stiffness:.2,render:{type:"line",anchors:!1}},p);var g=e.stack(i,t,l,f,u,x,function(y,v){return a.circle(y,v,C,M)});return e.mesh(g,l,f,S,p),g.label="Soft Body",g},r(e,"softBody","Composites.softBody âž¤ moved to softBody and cloth examples")})()},function(b,T,d){var e={};b.exports=e;var n=d(9),o=d(0),s=o.deprecated;(function(){e.create=function(c){var a={buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return o.extend(a,c)},e.update=function(c,a,r,i){var t,l,f,u=r.world,x=c.buckets,S,C,M=!1;for(t=0;t<a.length;t++){var p=a[t];if(!(p.isSleeping&&!i)&&!(u.bounds&&(p.bounds.max.x<u.bounds.min.x||p.bounds.min.x>u.bounds.max.x||p.bounds.max.y<u.bounds.min.y||p.bounds.min.y>u.bounds.max.y))){var g=e._getRegion(c,p);if(!p.region||g.id!==p.region.id||i){(!p.region||i)&&(p.region=g);var y=e._regionUnion(g,p.region);for(l=y.startCol;l<=y.endCol;l++)for(f=y.startRow;f<=y.endRow;f++){C=e._getBucketId(l,f),S=x[C];var v=l>=g.startCol&&l<=g.endCol&&f>=g.startRow&&f<=g.endRow,w=l>=p.region.startCol&&l<=p.region.endCol&&f>=p.region.startRow&&f<=p.region.endRow;!v&&w&&w&&S&&e._bucketRemoveBody(c,S,p),(p.region===g||v&&!w||i)&&(S||(S=e._createBucket(x,C)),e._bucketAddBody(c,S,p))}p.region=g,M=!0}}}M&&(c.pairsList=e._createActivePairsList(c))},s(e,"update","Grid.update âž¤ replaced by Matter.Detector"),e.clear=function(c){c.buckets={},c.pairs={},c.pairsList=[]},s(e,"clear","Grid.clear âž¤ replaced by Matter.Detector"),e._regionUnion=function(c,a){var r=Math.min(c.startCol,a.startCol),i=Math.max(c.endCol,a.endCol),t=Math.min(c.startRow,a.startRow),l=Math.max(c.endRow,a.endRow);return e._createRegion(r,i,t,l)},e._getRegion=function(c,a){var r=a.bounds,i=Math.floor(r.min.x/c.bucketWidth),t=Math.floor(r.max.x/c.bucketWidth),l=Math.floor(r.min.y/c.bucketHeight),f=Math.floor(r.max.y/c.bucketHeight);return e._createRegion(i,t,l,f)},e._createRegion=function(c,a,r,i){return{id:c+","+a+","+r+","+i,startCol:c,endCol:a,startRow:r,endRow:i}},e._getBucketId=function(c,a){return"C"+c+"R"+a},e._createBucket=function(c,a){var r=c[a]=[];return r},e._bucketAddBody=function(c,a,r){var i=c.pairs,t=n.id,l=a.length,f;for(f=0;f<l;f++){var u=a[f];if(!(r.id===u.id||r.isStatic&&u.isStatic)){var x=t(r,u),S=i[x];S?S[2]+=1:i[x]=[r,u,1]}}a.push(r)},e._bucketRemoveBody=function(c,a,r){var i=c.pairs,t=n.id,l;a.splice(o.indexOf(a,r),1);var f=a.length;for(l=0;l<f;l++){var u=i[t(r,a[l])];u&&(u[2]-=1)}},e._createActivePairsList=function(c){var a,r=c.pairs,i=o.keys(r),t=i.length,l=[],f;for(f=0;f<t;f++)a=r[i[f]],a[2]>0?l.push(a):delete r[i[f]];return l}})()},function(b,T,d){var e={};b.exports=e;var n=d(3),o=d(7),s=d(14),c=d(5),a=d(13),r=d(10),i=d(6),t=d(0),l=d(1);(function(){e.create=function(f,u){var x=(f?f.mouse:null)||(u?u.mouse:null);x||(f&&f.render&&f.render.canvas?x=s.create(f.render.canvas):u&&u.element?x=s.create(u.element):(x=s.create(),t.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var S=r.create({label:"Mouse Constraint",pointA:x.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),C={type:"mouseConstraint",mouse:x,element:null,body:null,constraint:S,collisionFilter:{category:1,mask:4294967295,group:0}},M=t.extend(C,u);return c.on(f,"beforeUpdate",function(){var p=i.allBodies(f.world);e.update(M,p),e._triggerEvents(M)}),M},e.update=function(f,u){var x=f.mouse,S=f.constraint,C=f.body;if(x.button===0){if(S.bodyB)o.set(S.bodyB,!1),S.pointA=x.position;else for(var M=0;M<u.length;M++)if(C=u[M],l.contains(C.bounds,x.position)&&a.canCollide(C.collisionFilter,f.collisionFilter))for(var p=C.parts.length>1?1:0;p<C.parts.length;p++){var g=C.parts[p];if(n.contains(g.vertices,x.position)){S.pointA=x.position,S.bodyB=f.body=C,S.pointB={x:x.position.x-C.position.x,y:x.position.y-C.position.y},S.angleB=C.angle,o.set(C,!1),c.trigger(f,"startdrag",{mouse:x,body:C});break}}}else S.bodyB=f.body=null,S.pointB=null,C&&c.trigger(f,"enddrag",{mouse:x,body:C})},e._triggerEvents=function(f){var u=f.mouse,x=u.sourceEvents;x.mousemove&&c.trigger(f,"mousemove",{mouse:u}),x.mousedown&&c.trigger(f,"mousedown",{mouse:u}),x.mouseup&&c.trigger(f,"mouseup",{mouse:u}),s.clearSourceEvents(u)}})()},function(b,T,d){var e={};b.exports=e;var n=d(2),o=d(8),s=d(1),c=d(12),a=d(3);(function(){e.collides=function(r,i){for(var t=[],l=i.length,f=r.bounds,u=o.collides,x=s.overlaps,S=0;S<l;S++){var C=i[S],M=C.parts.length,p=M===1?0:1;if(x(C.bounds,f))for(var g=p;g<M;g++){var y=C.parts[g];if(x(y.bounds,f)){var v=u(y,r);if(v){t.push(v);break}}}}return t},e.ray=function(r,i,t,l){l=l||1e-100;for(var f=n.angle(i,t),u=n.magnitude(n.sub(i,t)),x=(t.x+i.x)*.5,S=(t.y+i.y)*.5,C=c.rectangle(x,S,u,l,{angle:f}),M=e.collides(C,r),p=0;p<M.length;p+=1){var g=M[p];g.body=g.bodyB=g.bodyA}return M},e.region=function(r,i,t){for(var l=[],f=0;f<r.length;f++){var u=r[f],x=s.overlaps(u.bounds,i);(x&&!t||!x&&t)&&l.push(u)}return l},e.point=function(r,i){for(var t=[],l=0;l<r.length;l++){var f=r[l];if(s.contains(f.bounds,i))for(var u=f.parts.length===1?0:1;u<f.parts.length;u++){var x=f.parts[u];if(s.contains(x.bounds,i)&&a.contains(x.vertices,i)){t.push(f);break}}}return t}})()},function(b,T,d){var e={};b.exports=e;var n=d(4),o=d(0),s=d(6),c=d(1),a=d(5),r=d(2),i=d(14);(function(){var t,l;typeof window<"u"&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(p){window.setTimeout(function(){p(o.now())},1e3/60)},l=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),e._goodFps=30,e._goodDelta=1e3/60,e.create=function(p){var g={engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],engineUpdatesHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",wireframeStrokeStyle:"#bbb",hasBounds:!!p.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},y=o.extend(g,p);return y.canvas&&(y.canvas.width=y.options.width||y.canvas.width,y.canvas.height=y.options.height||y.canvas.height),y.mouse=p.mouse,y.engine=p.engine,y.canvas=y.canvas||x(y.options.width,y.options.height),y.context=y.canvas.getContext("2d"),y.textures={},y.bounds=y.bounds||{min:{x:0,y:0},max:{x:y.canvas.width,y:y.canvas.height}},y.controller=e,y.options.showBroadphase=!1,y.options.pixelRatio!==1&&e.setPixelRatio(y,y.options.pixelRatio),o.isElement(y.element)&&y.element.appendChild(y.canvas),y},e.run=function(p){(function g(y){p.frameRequestId=t(g),f(p,y),e.world(p,y),p.context.setTransform(p.options.pixelRatio,0,0,p.options.pixelRatio,0,0),(p.options.showStats||p.options.showDebug)&&e.stats(p,p.context,y),(p.options.showPerformance||p.options.showDebug)&&e.performance(p,p.context,y),p.context.setTransform(1,0,0,1,0,0)})()},e.stop=function(p){l(p.frameRequestId)},e.setPixelRatio=function(p,g){var y=p.options,v=p.canvas;g==="auto"&&(g=S(v)),y.pixelRatio=g,v.setAttribute("data-pixel-ratio",g),v.width=y.width*g,v.height=y.height*g,v.style.width=y.width+"px",v.style.height=y.height+"px"},e.setSize=function(p,g,y){p.options.width=g,p.options.height=y,p.bounds.max.x=p.bounds.min.x+g,p.bounds.max.y=p.bounds.min.y+y,p.options.pixelRatio!==1?e.setPixelRatio(p,p.options.pixelRatio):(p.canvas.width=g,p.canvas.height=y)},e.lookAt=function(p,g,y,v){v=typeof v<"u"?v:!0,g=o.isArray(g)?g:[g],y=y||{x:0,y:0};for(var w={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},h=0;h<g.length;h+=1){var m=g[h],P=m.bounds?m.bounds.min:m.min||m.position||m,I=m.bounds?m.bounds.max:m.max||m.position||m;P&&I&&(P.x<w.min.x&&(w.min.x=P.x),I.x>w.max.x&&(w.max.x=I.x),P.y<w.min.y&&(w.min.y=P.y),I.y>w.max.y&&(w.max.y=I.y))}var R=w.max.x-w.min.x+2*y.x,E=w.max.y-w.min.y+2*y.y,L=p.canvas.height,D=p.canvas.width,k=D/L,H=R/E,W=1,V=1;H>k?V=H/k:W=k/H,p.options.hasBounds=!0,p.bounds.min.x=w.min.x,p.bounds.max.x=w.min.x+R*W,p.bounds.min.y=w.min.y,p.bounds.max.y=w.min.y+E*V,v&&(p.bounds.min.x+=R*.5-R*W*.5,p.bounds.max.x+=R*.5-R*W*.5,p.bounds.min.y+=E*.5-E*V*.5,p.bounds.max.y+=E*.5-E*V*.5),p.bounds.min.x-=y.x,p.bounds.max.x-=y.x,p.bounds.min.y-=y.y,p.bounds.max.y-=y.y,p.mouse&&(i.setScale(p.mouse,{x:(p.bounds.max.x-p.bounds.min.x)/p.canvas.width,y:(p.bounds.max.y-p.bounds.min.y)/p.canvas.height}),i.setOffset(p.mouse,p.bounds.min))},e.startViewTransform=function(p){var g=p.bounds.max.x-p.bounds.min.x,y=p.bounds.max.y-p.bounds.min.y,v=g/p.options.width,w=y/p.options.height;p.context.setTransform(p.options.pixelRatio/v,0,0,p.options.pixelRatio/w,0,0),p.context.translate(-p.bounds.min.x,-p.bounds.min.y)},e.endViewTransform=function(p){p.context.setTransform(p.options.pixelRatio,0,0,p.options.pixelRatio,0,0)},e.world=function(p,g){var y=o.now(),v=p.engine,w=v.world,h=p.canvas,m=p.context,P=p.options,I=p.timing,R=s.allBodies(w),E=s.allConstraints(w),L=P.wireframes?P.wireframeBackground:P.background,D=[],k=[],H,W={timestamp:v.timing.timestamp};if(a.trigger(p,"beforeRender",W),p.currentBackground!==L&&M(p,L),m.globalCompositeOperation="source-in",m.fillStyle="transparent",m.fillRect(0,0,h.width,h.height),m.globalCompositeOperation="source-over",P.hasBounds){for(H=0;H<R.length;H++){var V=R[H];c.overlaps(V.bounds,p.bounds)&&D.push(V)}for(H=0;H<E.length;H++){var U=E[H],N=U.bodyA,K=U.bodyB,J=U.pointA,$=U.pointB;N&&(J=r.add(N.position,U.pointA)),K&&($=r.add(K.position,U.pointB)),!(!J||!$)&&(c.contains(p.bounds,J)||c.contains(p.bounds,$))&&k.push(U)}e.startViewTransform(p),p.mouse&&(i.setScale(p.mouse,{x:(p.bounds.max.x-p.bounds.min.x)/p.options.width,y:(p.bounds.max.y-p.bounds.min.y)/p.options.height}),i.setOffset(p.mouse,p.bounds.min))}else k=E,D=R,p.options.pixelRatio!==1&&p.context.setTransform(p.options.pixelRatio,0,0,p.options.pixelRatio,0,0);!P.wireframes||v.enableSleeping&&P.showSleeping?e.bodies(p,D,m):(P.showConvexHulls&&e.bodyConvexHulls(p,D,m),e.bodyWireframes(p,D,m)),P.showBounds&&e.bodyBounds(p,D,m),(P.showAxes||P.showAngleIndicator)&&e.bodyAxes(p,D,m),P.showPositions&&e.bodyPositions(p,D,m),P.showVelocity&&e.bodyVelocity(p,D,m),P.showIds&&e.bodyIds(p,D,m),P.showSeparations&&e.separations(p,v.pairs.list,m),P.showCollisions&&e.collisions(p,v.pairs.list,m),P.showVertexNumbers&&e.vertexNumbers(p,D,m),P.showMousePosition&&e.mousePosition(p,p.mouse,m),e.constraints(k,m),P.hasBounds&&e.endViewTransform(p),a.trigger(p,"afterRender",W),I.lastElapsed=o.now()-y},e.stats=function(p,g,y){for(var v=p.engine,w=v.world,h=s.allBodies(w),m=0,P=55,I=44,R=0,E=0,L=0;L<h.length;L+=1)m+=h[L].parts.length;var D={Part:m,Body:h.length,Cons:s.allConstraints(w).length,Comp:s.allComposites(w).length,Pair:v.pairs.list.length};g.fillStyle="#0e0f19",g.fillRect(R,E,P*5.5,I),g.font="12px Arial",g.textBaseline="top",g.textAlign="right";for(var k in D){var H=D[k];g.fillStyle="#aaa",g.fillText(k,R+P,E+8),g.fillStyle="#eee",g.fillText(H,R+P,E+26),R+=P}},e.performance=function(p,g){var y=p.engine,v=p.timing,w=v.deltaHistory,h=v.elapsedHistory,m=v.timestampElapsedHistory,P=v.engineDeltaHistory,I=v.engineUpdatesHistory,R=v.engineElapsedHistory,E=y.timing.lastUpdatesPerFrame,L=y.timing.lastDelta,D=u(w),k=u(h),H=u(P),W=u(I),V=u(R),U=u(m),N=U/D||0,K=Math.round(D/L),J=1e3/D||0,$=4,q=12,X=60,fe=34,j=10,_=69;g.fillStyle="#0e0f19",g.fillRect(0,50,q*5+X*6+22,fe),e.status(g,j,_,X,$,w.length,Math.round(J)+" fps",J/e._goodFps,function(Y){return w[Y]/D-1}),e.status(g,j+q+X,_,X,$,P.length,L.toFixed(2)+" dt",e._goodDelta/L,function(Y){return P[Y]/H-1}),e.status(g,j+(q+X)*2,_,X,$,I.length,E+" upf",Math.pow(o.clamp(W/K||1,0,1),4),function(Y){return I[Y]/W-1}),e.status(g,j+(q+X)*3,_,X,$,R.length,V.toFixed(2)+" ut",1-E*V/e._goodFps,function(Y){return R[Y]/V-1}),e.status(g,j+(q+X)*4,_,X,$,h.length,k.toFixed(2)+" rt",1-k/e._goodFps,function(Y){return h[Y]/k-1}),e.status(g,j+(q+X)*5,_,X,$,m.length,N.toFixed(2)+" x",N*N*N,function(Y){return(m[Y]/w[Y]/N||0)-1})},e.status=function(p,g,y,v,w,h,m,P,I){p.strokeStyle="#888",p.fillStyle="#444",p.lineWidth=1,p.fillRect(g,y+7,v,1),p.beginPath(),p.moveTo(g,y+7-w*o.clamp(.4*I(0),-2,2));for(var R=0;R<v;R+=1)p.lineTo(g+R,y+7-(R<h?w*o.clamp(.4*I(R),-2,2):0));p.stroke(),p.fillStyle="hsl("+o.clamp(25+95*P,0,120)+",100%,60%)",p.fillRect(g,y-7,4,4),p.font="12px Arial",p.textBaseline="middle",p.textAlign="right",p.fillStyle="#eee",p.fillText(m,g+v,y-5)},e.constraints=function(p,g){for(var y=g,v=0;v<p.length;v++){var w=p[v];if(!(!w.render.visible||!w.pointA||!w.pointB)){var h=w.bodyA,m=w.bodyB,P,I;if(h?P=r.add(h.position,w.pointA):P=w.pointA,w.render.type==="pin")y.beginPath(),y.arc(P.x,P.y,3,0,2*Math.PI),y.closePath();else{if(m?I=r.add(m.position,w.pointB):I=w.pointB,y.beginPath(),y.moveTo(P.x,P.y),w.render.type==="spring")for(var R=r.sub(I,P),E=r.perp(r.normalise(R)),L=Math.ceil(o.clamp(w.length/5,12,20)),D,k=1;k<L;k+=1)D=k%2===0?1:-1,y.lineTo(P.x+R.x*(k/L)+E.x*D*4,P.y+R.y*(k/L)+E.y*D*4);y.lineTo(I.x,I.y)}w.render.lineWidth&&(y.lineWidth=w.render.lineWidth,y.strokeStyle=w.render.strokeStyle,y.stroke()),w.render.anchors&&(y.fillStyle=w.render.strokeStyle,y.beginPath(),y.arc(P.x,P.y,3,0,2*Math.PI),y.arc(I.x,I.y,3,0,2*Math.PI),y.closePath(),y.fill())}}},e.bodies=function(p,g,y){var v=y;p.engine;var w=p.options,h=w.showInternalEdges||!w.wireframes,m,P,I,R;for(I=0;I<g.length;I++)if(m=g[I],!!m.render.visible){for(R=m.parts.length>1?1:0;R<m.parts.length;R++)if(P=m.parts[R],!!P.render.visible){if(w.showSleeping&&m.isSleeping?v.globalAlpha=.5*P.render.opacity:P.render.opacity!==1&&(v.globalAlpha=P.render.opacity),P.render.sprite&&P.render.sprite.texture&&!w.wireframes){var E=P.render.sprite,L=C(p,E.texture);v.translate(P.position.x,P.position.y),v.rotate(P.angle),v.drawImage(L,L.width*-E.xOffset*E.xScale,L.height*-E.yOffset*E.yScale,L.width*E.xScale,L.height*E.yScale),v.rotate(-P.angle),v.translate(-P.position.x,-P.position.y)}else{if(P.circleRadius)v.beginPath(),v.arc(P.position.x,P.position.y,P.circleRadius,0,2*Math.PI);else{v.beginPath(),v.moveTo(P.vertices[0].x,P.vertices[0].y);for(var D=1;D<P.vertices.length;D++)!P.vertices[D-1].isInternal||h?v.lineTo(P.vertices[D].x,P.vertices[D].y):v.moveTo(P.vertices[D].x,P.vertices[D].y),P.vertices[D].isInternal&&!h&&v.moveTo(P.vertices[(D+1)%P.vertices.length].x,P.vertices[(D+1)%P.vertices.length].y);v.lineTo(P.vertices[0].x,P.vertices[0].y),v.closePath()}w.wireframes?(v.lineWidth=1,v.strokeStyle=p.options.wireframeStrokeStyle,v.stroke()):(v.fillStyle=P.render.fillStyle,P.render.lineWidth&&(v.lineWidth=P.render.lineWidth,v.strokeStyle=P.render.strokeStyle,v.stroke()),v.fill())}v.globalAlpha=1}}},e.bodyWireframes=function(p,g,y){var v=y,w=p.options.showInternalEdges,h,m,P,I,R;for(v.beginPath(),P=0;P<g.length;P++)if(h=g[P],!!h.render.visible)for(R=h.parts.length>1?1:0;R<h.parts.length;R++){for(m=h.parts[R],v.moveTo(m.vertices[0].x,m.vertices[0].y),I=1;I<m.vertices.length;I++)!m.vertices[I-1].isInternal||w?v.lineTo(m.vertices[I].x,m.vertices[I].y):v.moveTo(m.vertices[I].x,m.vertices[I].y),m.vertices[I].isInternal&&!w&&v.moveTo(m.vertices[(I+1)%m.vertices.length].x,m.vertices[(I+1)%m.vertices.length].y);v.lineTo(m.vertices[0].x,m.vertices[0].y)}v.lineWidth=1,v.strokeStyle=p.options.wireframeStrokeStyle,v.stroke()},e.bodyConvexHulls=function(p,g,y){var v=y,w,h,m;for(v.beginPath(),h=0;h<g.length;h++)if(w=g[h],!(!w.render.visible||w.parts.length===1)){for(v.moveTo(w.vertices[0].x,w.vertices[0].y),m=1;m<w.vertices.length;m++)v.lineTo(w.vertices[m].x,w.vertices[m].y);v.lineTo(w.vertices[0].x,w.vertices[0].y)}v.lineWidth=1,v.strokeStyle="rgba(255,255,255,0.2)",v.stroke()},e.vertexNumbers=function(p,g,y){var v=y,w,h,m;for(w=0;w<g.length;w++){var P=g[w].parts;for(m=P.length>1?1:0;m<P.length;m++){var I=P[m];for(h=0;h<I.vertices.length;h++)v.fillStyle="rgba(255,255,255,0.2)",v.fillText(w+"_"+h,I.position.x+(I.vertices[h].x-I.position.x)*.8,I.position.y+(I.vertices[h].y-I.position.y)*.8)}}},e.mousePosition=function(p,g,y){var v=y;v.fillStyle="rgba(255,255,255,0.8)",v.fillText(g.position.x+"  "+g.position.y,g.position.x+5,g.position.y-5)},e.bodyBounds=function(p,g,y){var v=y;p.engine;var w=p.options;v.beginPath();for(var h=0;h<g.length;h++){var m=g[h];if(m.render.visible)for(var P=g[h].parts,I=P.length>1?1:0;I<P.length;I++){var R=P[I];v.rect(R.bounds.min.x,R.bounds.min.y,R.bounds.max.x-R.bounds.min.x,R.bounds.max.y-R.bounds.min.y)}}w.wireframes?v.strokeStyle="rgba(255,255,255,0.08)":v.strokeStyle="rgba(0,0,0,0.1)",v.lineWidth=1,v.stroke()},e.bodyAxes=function(p,g,y){var v=y;p.engine;var w=p.options,h,m,P,I;for(v.beginPath(),m=0;m<g.length;m++){var R=g[m],E=R.parts;if(R.render.visible)if(w.showAxes)for(P=E.length>1?1:0;P<E.length;P++)for(h=E[P],I=0;I<h.axes.length;I++){var L=h.axes[I];v.moveTo(h.position.x,h.position.y),v.lineTo(h.position.x+L.x*20,h.position.y+L.y*20)}else for(P=E.length>1?1:0;P<E.length;P++)for(h=E[P],I=0;I<h.axes.length;I++)v.moveTo(h.position.x,h.position.y),v.lineTo((h.vertices[0].x+h.vertices[h.vertices.length-1].x)/2,(h.vertices[0].y+h.vertices[h.vertices.length-1].y)/2)}w.wireframes?(v.strokeStyle="indianred",v.lineWidth=1):(v.strokeStyle="rgba(255, 255, 255, 0.4)",v.globalCompositeOperation="overlay",v.lineWidth=2),v.stroke(),v.globalCompositeOperation="source-over"},e.bodyPositions=function(p,g,y){var v=y;p.engine;var w=p.options,h,m,P,I;for(v.beginPath(),P=0;P<g.length;P++)if(h=g[P],!!h.render.visible)for(I=0;I<h.parts.length;I++)m=h.parts[I],v.arc(m.position.x,m.position.y,3,0,2*Math.PI,!1),v.closePath();for(w.wireframes?v.fillStyle="indianred":v.fillStyle="rgba(0,0,0,0.5)",v.fill(),v.beginPath(),P=0;P<g.length;P++)h=g[P],h.render.visible&&(v.arc(h.positionPrev.x,h.positionPrev.y,2,0,2*Math.PI,!1),v.closePath());v.fillStyle="rgba(255,165,0,0.8)",v.fill()},e.bodyVelocity=function(p,g,y){var v=y;v.beginPath();for(var w=0;w<g.length;w++){var h=g[w];if(h.render.visible){var m=n.getVelocity(h);v.moveTo(h.position.x,h.position.y),v.lineTo(h.position.x+m.x,h.position.y+m.y)}}v.lineWidth=3,v.strokeStyle="cornflowerblue",v.stroke()},e.bodyIds=function(p,g,y){var v=y,w,h;for(w=0;w<g.length;w++)if(g[w].render.visible){var m=g[w].parts;for(h=m.length>1?1:0;h<m.length;h++){var P=m[h];v.font="12px Arial",v.fillStyle="rgba(255,255,255,0.5)",v.fillText(P.id,P.position.x+10,P.position.y-10)}}},e.collisions=function(p,g,y){var v=y,w=p.options,h,m,P,I;for(v.beginPath(),P=0;P<g.length;P++)if(h=g[P],!!h.isActive)for(m=h.collision,I=0;I<h.contactCount;I++){var R=h.contacts[I],E=R.vertex;v.rect(E.x-1.5,E.y-1.5,3.5,3.5)}for(w.wireframes?v.fillStyle="rgba(255,255,255,0.7)":v.fillStyle="orange",v.fill(),v.beginPath(),P=0;P<g.length;P++)if(h=g[P],!!h.isActive&&(m=h.collision,h.contactCount>0)){var L=h.contacts[0].vertex.x,D=h.contacts[0].vertex.y;h.contactCount===2&&(L=(h.contacts[0].vertex.x+h.contacts[1].vertex.x)/2,D=(h.contacts[0].vertex.y+h.contacts[1].vertex.y)/2),m.bodyB===m.supports[0].body||m.bodyA.isStatic===!0?v.moveTo(L-m.normal.x*8,D-m.normal.y*8):v.moveTo(L+m.normal.x*8,D+m.normal.y*8),v.lineTo(L,D)}w.wireframes?v.strokeStyle="rgba(255,165,0,0.7)":v.strokeStyle="orange",v.lineWidth=1,v.stroke()},e.separations=function(p,g,y){var v=y,w=p.options,h,m,P,I,R;for(v.beginPath(),R=0;R<g.length;R++)if(h=g[R],!!h.isActive){m=h.collision,P=m.bodyA,I=m.bodyB;var E=1;!I.isStatic&&!P.isStatic&&(E=.5),I.isStatic&&(E=0),v.moveTo(I.position.x,I.position.y),v.lineTo(I.position.x-m.penetration.x*E,I.position.y-m.penetration.y*E),E=1,!I.isStatic&&!P.isStatic&&(E=.5),P.isStatic&&(E=0),v.moveTo(P.position.x,P.position.y),v.lineTo(P.position.x+m.penetration.x*E,P.position.y+m.penetration.y*E)}w.wireframes?v.strokeStyle="rgba(255,165,0,0.5)":v.strokeStyle="orange",v.stroke()},e.inspector=function(p,g){p.engine;var y=p.selected,v=p.render,w=v.options,h;if(w.hasBounds){var m=v.bounds.max.x-v.bounds.min.x,P=v.bounds.max.y-v.bounds.min.y,I=m/v.options.width,R=P/v.options.height;g.scale(1/I,1/R),g.translate(-v.bounds.min.x,-v.bounds.min.y)}for(var E=0;E<y.length;E++){var L=y[E].data;switch(g.translate(.5,.5),g.lineWidth=1,g.strokeStyle="rgba(255,165,0,0.9)",g.setLineDash([1,2]),L.type){case"body":h=L.bounds,g.beginPath(),g.rect(Math.floor(h.min.x-3),Math.floor(h.min.y-3),Math.floor(h.max.x-h.min.x+6),Math.floor(h.max.y-h.min.y+6)),g.closePath(),g.stroke();break;case"constraint":var D=L.pointA;L.bodyA&&(D=L.pointB),g.beginPath(),g.arc(D.x,D.y,10,0,2*Math.PI),g.closePath(),g.stroke();break}g.setLineDash([]),g.translate(-.5,-.5)}p.selectStart!==null&&(g.translate(.5,.5),g.lineWidth=1,g.strokeStyle="rgba(255,165,0,0.6)",g.fillStyle="rgba(255,165,0,0.1)",h=p.selectBounds,g.beginPath(),g.rect(Math.floor(h.min.x),Math.floor(h.min.y),Math.floor(h.max.x-h.min.x),Math.floor(h.max.y-h.min.y)),g.closePath(),g.stroke(),g.fill(),g.translate(-.5,-.5)),w.hasBounds&&g.setTransform(1,0,0,1,0,0)};var f=function(p,g){var y=p.engine,v=p.timing,w=v.historySize,h=y.timing.timestamp;v.delta=g-v.lastTime||e._goodDelta,v.lastTime=g,v.timestampElapsed=h-v.lastTimestamp||0,v.lastTimestamp=h,v.deltaHistory.unshift(v.delta),v.deltaHistory.length=Math.min(v.deltaHistory.length,w),v.engineDeltaHistory.unshift(y.timing.lastDelta),v.engineDeltaHistory.length=Math.min(v.engineDeltaHistory.length,w),v.timestampElapsedHistory.unshift(v.timestampElapsed),v.timestampElapsedHistory.length=Math.min(v.timestampElapsedHistory.length,w),v.engineUpdatesHistory.unshift(y.timing.lastUpdatesPerFrame),v.engineUpdatesHistory.length=Math.min(v.engineUpdatesHistory.length,w),v.engineElapsedHistory.unshift(y.timing.lastElapsed),v.engineElapsedHistory.length=Math.min(v.engineElapsedHistory.length,w),v.elapsedHistory.unshift(v.lastElapsed),v.elapsedHistory.length=Math.min(v.elapsedHistory.length,w)},u=function(p){for(var g=0,y=0;y<p.length;y+=1)g+=p[y];return g/p.length||0},x=function(p,g){var y=document.createElement("canvas");return y.width=p,y.height=g,y.oncontextmenu=function(){return!1},y.onselectstart=function(){return!1},y},S=function(p){var g=p.getContext("2d"),y=window.devicePixelRatio||1,v=g.webkitBackingStorePixelRatio||g.mozBackingStorePixelRatio||g.msBackingStorePixelRatio||g.oBackingStorePixelRatio||g.backingStorePixelRatio||1;return y/v},C=function(p,g){var y=p.textures[g];return y||(y=p.textures[g]=new Image,y.src=g,y)},M=function(p,g){var y=g;/(jpg|gif|png)$/.test(g)&&(y="url("+g+")"),p.canvas.style.background=y,p.canvas.style.backgroundSize="contain",p.currentBackground=g}})()},function(b,T,d){var e={};b.exports=e;var n=d(5),o=d(17),s=d(0);(function(){e._maxFrameDelta=1e3/15,e._frameDeltaFallback=1e3/60,e._timeBufferMargin=1.5,e._elapsedNextEstimate=1,e._smoothingLowerBound=.1,e._smoothingUpperBound=.9,e.create=function(a){var r={delta:16.666666666666668,frameDelta:null,frameDeltaSmoothing:!0,frameDeltaSnapping:!0,frameDeltaHistory:[],frameDeltaHistorySize:100,frameRequestId:null,timeBuffer:0,timeLastTick:null,maxUpdates:null,maxFrameTime:33.333333333333336,lastUpdatesDeferred:0,enabled:!0},i=s.extend(r,a);return i.fps=0,i},e.run=function(a,r){return a.timeBuffer=e._frameDeltaFallback,function i(t){a.frameRequestId=e._onNextFrame(a,i),t&&a.enabled&&e.tick(a,r,t)}(),a},e.tick=function(a,r,i){var t=s.now(),l=a.delta,f=0,u=i-a.timeLastTick;if((!u||!a.timeLastTick||u>Math.max(e._maxFrameDelta,a.maxFrameTime))&&(u=a.frameDelta||e._frameDeltaFallback),a.frameDeltaSmoothing){a.frameDeltaHistory.push(u),a.frameDeltaHistory=a.frameDeltaHistory.slice(-a.frameDeltaHistorySize);var x=a.frameDeltaHistory.slice(0).sort(),S=a.frameDeltaHistory.slice(x.length*e._smoothingLowerBound,x.length*e._smoothingUpperBound),C=c(S);u=C||u}a.frameDeltaSnapping&&(u=1e3/Math.round(1e3/u)),a.frameDelta=u,a.timeLastTick=i,a.timeBuffer+=a.frameDelta,a.timeBuffer=s.clamp(a.timeBuffer,0,a.frameDelta+l*e._timeBufferMargin),a.lastUpdatesDeferred=0;var M=a.maxUpdates||Math.ceil(a.maxFrameTime/l),p={timestamp:r.timing.timestamp};n.trigger(a,"beforeTick",p),n.trigger(a,"tick",p);for(var g=s.now();l>0&&a.timeBuffer>=l*e._timeBufferMargin;){n.trigger(a,"beforeUpdate",p),o.update(r,l),n.trigger(a,"afterUpdate",p),a.timeBuffer-=l,f+=1;var y=s.now()-t,v=s.now()-g,w=y+e._elapsedNextEstimate*v/f;if(f>=M||w>a.maxFrameTime){a.lastUpdatesDeferred=Math.round(Math.max(0,a.timeBuffer/l-e._timeBufferMargin));break}}r.timing.lastUpdatesPerFrame=f,n.trigger(a,"afterTick",p),a.frameDeltaHistory.length>=100&&(a.lastUpdatesDeferred&&Math.round(a.frameDelta/l)>M?s.warnOnce("Matter.Runner: runner reached runner.maxUpdates, see docs."):a.lastUpdatesDeferred&&s.warnOnce("Matter.Runner: runner reached runner.maxFrameTime, see docs."),typeof a.isFixed<"u"&&s.warnOnce("Matter.Runner: runner.isFixed is now redundant, see docs."),(a.deltaMin||a.deltaMax)&&s.warnOnce("Matter.Runner: runner.deltaMin and runner.deltaMax were removed, see docs."),a.fps!==0&&s.warnOnce("Matter.Runner: runner.fps was replaced by runner.delta, see docs."))},e.stop=function(a){e._cancelNextFrame(a)},e._onNextFrame=function(a,r){if(typeof window<"u"&&window.requestAnimationFrame)a.frameRequestId=window.requestAnimationFrame(r);else throw new Error("Matter.Runner: missing required global window.requestAnimationFrame.");return a.frameRequestId},e._cancelNextFrame=function(a){if(typeof window<"u"&&window.cancelAnimationFrame)window.cancelAnimationFrame(a.frameRequestId);else throw new Error("Matter.Runner: missing required global window.cancelAnimationFrame.")};var c=function(a){for(var r=0,i=a.length,t=0;t<i;t+=1)r+=a[t];return r/i||0}})()},function(b,T,d){var e={};b.exports=e;var n=d(8),o=d(0),s=o.deprecated;(function(){e.collides=function(c,a){return n.collides(c,a)},s(e,"collides","SAT.collides âž¤ replaced by Collision.collides")})()},function(b,T,d){var e={};b.exports=e,d(1);var n=d(0);(function(){e.pathToVertices=function(o,s){typeof window<"u"&&!("SVGPathSeg"in window)&&n.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var c,a,r,i,t,l,f,u,x,S,C=[],M,p,g=0,y=0,v=0;s=s||15;var w=function(m,P,I){var R=I%2===1&&I>1;if(!x||m!=x.x||P!=x.y){x&&R?(M=x.x,p=x.y):(M=0,p=0);var E={x:M+m,y:p+P};(R||!x)&&(x=E),C.push(E),y=M+m,v=p+P}},h=function(m){var P=m.pathSegTypeAsLetter.toUpperCase();if(P!=="Z"){switch(P){case"M":case"L":case"T":case"C":case"S":case"Q":y=m.x,v=m.y;break;case"H":y=m.x;break;case"V":v=m.y;break}w(y,v,m.pathSegType)}};for(e._svgPathToAbsolute(o),r=o.getTotalLength(),l=[],c=0;c<o.pathSegList.numberOfItems;c+=1)l.push(o.pathSegList.getItem(c));for(f=l.concat();g<r;){if(S=o.getPathSegAtLength(g),t=l[S],t!=u){for(;f.length&&f[0]!=t;)h(f.shift());u=t}switch(t.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":i=o.getPointAtLength(g),w(i.x,i.y,0);break}g+=s}for(c=0,a=f.length;c<a;++c)h(f[c]);return C},e._svgPathToAbsolute=function(o){for(var s,c,a,r,i,t,l=o.pathSegList,f=0,u=0,x=l.numberOfItems,S=0;S<x;++S){var C=l.getItem(S),M=C.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(M))"x"in C&&(f=C.x),"y"in C&&(u=C.y);else switch("x1"in C&&(a=f+C.x1),"x2"in C&&(i=f+C.x2),"y1"in C&&(r=u+C.y1),"y2"in C&&(t=u+C.y2),"x"in C&&(f+=C.x),"y"in C&&(u+=C.y),M){case"m":l.replaceItem(o.createSVGPathSegMovetoAbs(f,u),S);break;case"l":l.replaceItem(o.createSVGPathSegLinetoAbs(f,u),S);break;case"h":l.replaceItem(o.createSVGPathSegLinetoHorizontalAbs(f),S);break;case"v":l.replaceItem(o.createSVGPathSegLinetoVerticalAbs(u),S);break;case"c":l.replaceItem(o.createSVGPathSegCurvetoCubicAbs(f,u,a,r,i,t),S);break;case"s":l.replaceItem(o.createSVGPathSegCurvetoCubicSmoothAbs(f,u,i,t),S);break;case"q":l.replaceItem(o.createSVGPathSegCurvetoQuadraticAbs(f,u,a,r),S);break;case"t":l.replaceItem(o.createSVGPathSegCurvetoQuadraticSmoothAbs(f,u),S);break;case"a":l.replaceItem(o.createSVGPathSegArcAbs(f,u,C.r1,C.r2,C.angle,C.largeArcFlag,C.sweepFlag),S);break;case"z":case"Z":f=s,u=c;break}(M=="M"||M=="m")&&(s=f,c=u)}}})()},function(b,T,d){var e={};b.exports=e;var n=d(6);d(0),function(){e.create=n.create,e.add=n.add,e.remove=n.remove,e.clear=n.clear,e.addComposite=n.addComposite,e.addBody=n.addBody,e.addConstraint=n.addConstraint}()}])})})(He);var ot=He.exports;const st=it(ot),{Engine:me,World:rt,Bodies:ze,Body:oe,Events:mt,Composite:ye}=st;function at(A,B,b=4e-4){const T=me.create({gravity:{x:0,y:1,scale:b}}),d=[];for(const w of A.segments){for(let h=0;h<w.points.length-1;h++){const m=w.points[h],P=w.points[h+1],I=Se(m.x,m.y,P.x,P.y);d.push(I)}for(let h=0;h<w.rightPoints.length-1;h++){const m=w.rightPoints[h],P=w.rightPoints[h+1],I=Se(m.x,m.y,P.x,P.y);d.push(I)}if(w.dividers)for(const h of w.dividers)for(let m=0;m<h.length-1;m++){const P=h[m],I=h[m+1],R=Se(P.x,P.y,I.x,I.y);d.push(R)}}ye.add(T.world,d);const e=new Map,n=A.startX,o=A.startY,s=A.funnelLeft+ne+5,a=A.funnelRight-ne-5-s;B.forEach((w,h)=>{const m=Math.max(1,Math.floor(a/(ne*2+8))),P=Math.min(B.length,m),I=Math.floor(h/P),R=h%P,E=Math.min(ne*2+10,a/P),L=Math.min(P,B.length-I*P),D=(R-(L-1)/2)*E,k=I*(ne*2+6),H=ze.circle(n+D,o+k,ne,{restitution:.4,friction:.03,frictionAir:.005,density:.002,label:`marble_${w.id}`});oe.setVelocity(H,{x:(Math.random()-.5)*.3,y:0}),e.set(w.id,H),ye.add(T.world,H)});const r=nt(A),i=new Set,t=new Map,l=new Set,f=new Map;let u=0;const x=500,S=new Map,C=800,M=6;function p(w){const{x:h,y:m}=w.position;return h<A.boundsMinX-x||h>A.boundsMaxX+x||m<A.boundsMinY-x||m>A.boundsMaxY+x}function g(w){u+=w,me.update(T,w);for(const[h,m]of e)i.has(h)||l.has(h)||(m.position.y>=r?(i.add(h),t.set(h,u)):p(m)&&(l.add(h),f.set(h,{x:m.position.x,y:m.position.y,angle:m.angle}),ye.remove(T.world,m)));for(const[h,m]of e){if(i.has(h)||l.has(h))continue;const P=S.get(h);if(!P||u-P.time>=C)if(P){const I=m.position.y-P.y,R=Math.sqrt(m.velocity.x**2+m.velocity.y**2);if(I<M&&R<2){const E=P.stuckCount+1,L=Math.min(E,8);if(E>=5)oe.setPosition(m,{x:m.position.x+(Math.random()-.5)*40,y:m.position.y+25+E*5}),oe.setVelocity(m,{x:(Math.random()-.5)*12,y:8+Math.random()*6+E*2});else if(E>=3)oe.setPosition(m,{x:m.position.x+(Math.random()-.5)*25,y:m.position.y+15}),oe.setVelocity(m,{x:(Math.random()-.5)*8,y:6+Math.random()*4});else{const D=(Math.random()-.5)*6*L,k=(3+Math.random()*3)*L;oe.setVelocity(m,{x:m.velocity.x+D,y:m.velocity.y+k})}S.set(h,{x:m.position.x,y:m.position.y,time:u,stuckCount:E})}else S.set(h,{x:m.position.x,y:m.position.y,time:u,stuckCount:0})}else S.set(h,{x:m.position.x,y:m.position.y,time:u,stuckCount:0})}}function y(){const w=[];for(const[h,m]of e){const P=l.has(h),I=f.get(h);w.push({id:h,x:P&&I?I.x:m.position.x,y:P&&I?I.y:m.position.y,angle:P&&I?I.angle:m.angle,vx:P?0:m.velocity.x,vy:P?0:m.velocity.y,finished:i.has(h),finishTime:t.get(h),disqualified:P})}return w.sort((h,m)=>h.disqualified&&!m.disqualified?1:!h.disqualified&&m.disqualified?-1:h.disqualified&&m.disqualified?0:h.finished&&m.finished?(h.finishTime||0)-(m.finishTime||0):h.finished?-1:m.finished?1:m.y-h.y),w.forEach((h,m)=>{h.position=m+1}),w}function v(){rt.clear(T.world,!1),me.clear(T)}return{engine:T,marbleBodies:e,finishY:r,update:g,getMarbleStates:y,destroy:v}}function Se(A,B,b,T){const d=(A+b)/2,e=(B+T)/2,n=b-A,o=T-B,s=Math.sqrt(n*n+o*o),c=Math.atan2(o,n);return ze.rectangle(d,e,s+2,10,{isStatic:!0,angle:c,friction:.15,restitution:.4,render:{fillStyle:"#555"}})}function lt(A){const B=document.createElement("canvas");B.style.display="block",B.style.width="100%",B.style.height="100%",B.style.background="#1a1a2e",A.appendChild(B);const b=B.getContext("2d");function T(){B.width=A.clientWidth,B.height=A.clientHeight}function d(e,n,o,s,c){const{width:a,height:r}=B;b.clearRect(0,0,a,r);const i=b.createLinearGradient(0,0,0,r);i.addColorStop(0,"#1a1a2e"),i.addColorStop(1,"#16213e"),b.fillStyle=i,b.fillRect(0,0,a,r),ft(b,e,s),ct(b,e,s),ut(b,n,o,s)}return{canvas:B,ctx:b,resize:T,render:d}}function ft(A,B,b){A.beginPath();let T=!0;for(const d of B.segments)for(const e of d.points){const n=b.worldToScreen(e.x,e.y);T?(A.moveTo(n.x,n.y),T=!1):A.lineTo(n.x,n.y)}for(let d=B.segments.length-1;d>=0;d--){const e=B.segments[d];for(let n=e.rightPoints.length-1;n>=0;n--){const o=e.rightPoints[n],s=b.worldToScreen(o.x,o.y);A.lineTo(s.x,s.y)}}A.closePath(),A.fillStyle="rgba(40, 40, 80, 0.6)",A.fill(),A.strokeStyle="#4a90d9",A.lineWidth=3,A.lineJoin="round",A.lineCap="round",A.beginPath(),T=!0;for(const d of B.segments)for(const e of d.points){const n=b.worldToScreen(e.x,e.y);T?(A.moveTo(n.x,n.y),T=!1):A.lineTo(n.x,n.y)}A.stroke(),A.beginPath(),T=!0;for(const d of B.segments)for(const e of d.rightPoints){const n=b.worldToScreen(e.x,e.y);T?(A.moveTo(n.x,n.y),T=!1):A.lineTo(n.x,n.y)}A.stroke(),A.strokeStyle="#4a90d9",A.lineWidth=3;for(const d of B.segments)if(d.dividers)for(const e of d.dividers){if(e.length<2)continue;A.beginPath();const n=b.worldToScreen(e[0].x,e[0].y);A.moveTo(n.x,n.y);for(let o=1;o<e.length;o++){const s=b.worldToScreen(e[o].x,e[o].y);A.lineTo(s.x,s.y)}A.stroke()}}function ct(A,B,b){const T=B.segments[B.segments.length-1],d=T.points[0],e=T.rightPoints[0],n=b.worldToScreen(d.x,d.y),o=b.worldToScreen(e.x,e.y),s=10*b.zoom,c=o.x-n.x,a=o.y-n.y,r=Math.sqrt(c*c+a*a),i=Math.ceil(r/s),t=Math.atan2(a,c);A.save(),A.translate(n.x,n.y),A.rotate(t);for(let u=0;u<i;u++)for(let x=0;x<2;x++){const S=(u+x)%2===0;A.fillStyle=S?"#ffffff":"#000000",A.fillRect(u*s,x*s-s,s,s)}A.restore();const l=(n.x+o.x)/2,f=(n.y+o.y)/2;A.font=`bold ${16*b.zoom}px monospace`,A.textAlign="center",A.fillStyle="#ffd700",A.strokeStyle="#000",A.lineWidth=3,A.strokeText("FINISH",l,f-20*b.zoom),A.fillText("FINISH",l,f-20*b.zoom)}function ut(A,B,b,T){const d=[...b].sort((e,n)=>(n.position||999)-(e.position||999));for(const e of d){const n=B.find(r=>r.id===e.id);if(!n)continue;const o=T.worldToScreen(e.x,e.y),s=ne*T.zoom;A.beginPath(),A.arc(o.x+2,o.y+2,s,0,Math.PI*2),A.fillStyle="rgba(0, 0, 0, 0.3)",A.fill(),A.beginPath(),A.arc(o.x,o.y,s,0,Math.PI*2),A.fillStyle=n.color,A.fill(),A.strokeStyle="rgba(255, 255, 255, 0.3)",A.lineWidth=1.5,A.stroke(),A.beginPath(),A.arc(o.x-s*.3,o.y-s*.3,s*.35,0,Math.PI*2),A.fillStyle="rgba(255, 255, 255, 0.4)",A.fill(),A.save(),A.translate(o.x,o.y),A.rotate(e.angle),A.beginPath(),A.moveTo(-s*.6,0),A.lineTo(s*.6,0),A.strokeStyle="rgba(255, 255, 255, 0.25)",A.lineWidth=2,A.stroke(),A.restore();const c=Math.max(10,12*T.zoom);A.font=`bold ${c}px monospace`,A.textAlign="center";const a=A.measureText(n.name).width+8;if(A.fillStyle="rgba(0, 0, 0, 0.6)",A.roundRect(o.x-a/2,o.y-s-c-8,a,c+4,3),A.fill(),A.fillStyle="#fff",A.fillText(n.name,o.x,o.y-s-6),e.position&&e.position<=3){const r=["","#ffd700","#c0c0c0","#cd7f32"],i=8*T.zoom;A.beginPath(),A.arc(o.x+s,o.y-s,i,0,Math.PI*2),A.fillStyle=r[e.position],A.fill(),A.strokeStyle="#fff",A.lineWidth=1,A.stroke(),A.font=`bold ${i}px monospace`,A.fillStyle="#000",A.textAlign="center",A.fillText(String(e.position),o.x+s,o.y-s+i*.35)}}}function dt(A,B){const b={x:0,y:0,zoom:1,targetId:null,screenWidth:A,screenHeight:B,finishLineX:0,finishLineY:0,update(T,d){if(T.length===0)return;let e,n;if(b.targetId){const s=T.find(c=>c.id===b.targetId);if(s&&!s.finished&&!s.disqualified)e=s.x,n=s.y;else return b.targetId=null,b.update(T,d)}else{const s=T.filter(c=>!c.finished&&!c.disqualified);if(s.length>0){const c=s.reduce((a,r)=>r.y>a.y?r:a);e=c.x,n=c.y}else e=b.finishLineX,n=b.finishLineY}const o=.05;b.x+=(e-b.x)*o,b.y+=(n-b.y)*o},worldToScreen(T,d){return{x:(T-b.x)*b.zoom+b.screenWidth/2,y:(d-b.y)*b.zoom+b.screenHeight/2}},setTarget(T){b.targetId=T},setZoom(T){b.zoom=Math.max(.3,Math.min(3,T))}};return b}function Oe(A){const B=document.createElement("div");B.id="hud",B.style.cssText=`
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    font-family: 'Segoe UI', monospace;
    color: #fff;
  `,A.appendChild(B);const b=document.createElement("div");b.style.cssText=`
    position: absolute;
    top: 16px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 24px;
    font-weight: bold;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
  `,B.appendChild(b);const T=document.createElement("div");T.style.cssText=`
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 120px;
    font-weight: bold;
    text-shadow: 4px 4px 8px rgba(0,0,0,0.8);
    opacity: 0;
    transition: opacity 0.2s, transform 0.2s;
  `,B.appendChild(T);const d=document.createElement("div");d.style.cssText=`
    position: absolute;
    top: 16px;
    right: 16px;
    background: rgba(0, 0, 0, 0.6);
    border-radius: 8px;
    padding: 12px 16px;
    min-width: 180px;
    backdrop-filter: blur(4px);
  `,B.appendChild(d);const e=document.createElement("div");e.style.cssText=`
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.85);
    border-radius: 16px;
    padding: 32px 48px;
    min-width: 350px;
    backdrop-filter: blur(8px);
    display: none;
    pointer-events: auto;
    border: 2px solid rgba(255, 215, 0, 0.3);
  `,B.appendChild(e);let n=-1;function o(a,r,i,t,l){if(t==="racing"||t==="finished"){const x=(i/1e3).toFixed(1);b.textContent=`${x}s`,b.style.opacity="1"}else b.style.opacity="0";if(t==="countdown"){const x=Math.ceil(l);x!==n&&(n=x,T.textContent=x>0?String(x):"GO!",T.style.color=x>0?"#fff":"#2ecc40",T.style.opacity="1",T.style.transform="translate(-50%, -50%) scale(1)",setTimeout(()=>{T.style.transform="translate(-50%, -50%) scale(1.3)",T.style.opacity="0.5"},600))}else T.style.opacity="0",n=-1;const f=[...r].sort((x,S)=>(x.position||999)-(S.position||999));let u='<div style="font-size: 14px; font-weight: bold; margin-bottom: 8px; color: #ffd700;">POSITIONS</div>';for(const x of f){const S=a.find(v=>v.id===x.id);if(!S)continue;const C=x.position||"?",M=x.disqualified,p=M?"":C===1?"ðŸ¥‡":C===2?"ðŸ¥ˆ":C===3?"ðŸ¥‰":"",g=M?" DQ":x.finished?" âœ“":"",y=x.finishTime?` (${(x.finishTime/1e3).toFixed(1)}s)`:"";u+=`
        <div style="display: flex; align-items: center; gap: 8px; padding: 3px 0; font-size: 13px;
          ${M?"opacity: 0.4; text-decoration: line-through;":x.finished?"opacity: 0.7;":""}">
          <span style="min-width: 24px;">${M?"DQ":p||C+"."}</span>
          <span style="width: 10px; height: 10px; border-radius: 50%; background: ${S.color}; flex-shrink: 0;"></span>
          <span style="flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${S.name}</span>
          <span style="color: ${M?"#ff4136":"#aaa"}; font-size: 11px;">${M?"DQ":y+g}</span>
        </div>
      `}d.innerHTML=u}function s(a){e.style.display="block";let r='<div style="text-align: center; font-size: 28px; font-weight: bold; color: #ffd700; margin-bottom: 20px;">RACE RESULTS</div>';for(const i of a){const t=i.finishTime<0,l=t?"":i.position===1?"ðŸ¥‡":i.position===2?"ðŸ¥ˆ":i.position===3?"ðŸ¥‰":"",f=i.position===1&&!t;r+=`
        <div style="display: flex; align-items: center; gap: 12px; padding: 8px 0; font-size: ${f?"18px":"15px"};
          ${f?"color: #ffd700;":""} ${t?"opacity: 0.4; text-decoration: line-through;":""}">
          <span style="min-width: 32px; text-align: center;">${t?"DQ":l||i.position+"."}</span>
          <span style="width: 14px; height: 14px; border-radius: 50%; background: ${i.marbleColor}; flex-shrink: 0;"></span>
          <span style="flex: 1; font-weight: ${f?"bold":"normal"};">${i.marbleName}</span>
          <span style="color: ${t?"#ff4136":"#aaa"};">${t?"Disqualified":(i.finishTime/1e3).toFixed(2)+"s"}</span>
        </div>
      `}r+=`
      <div style="text-align: center; margin-top: 24px; pointer-events: auto;">
        <button id="btn-new-race" style="
          background: #4a90d9;
          color: #fff;
          border: none;
          padding: 12px 32px;
          font-size: 16px;
          border-radius: 8px;
          cursor: pointer;
          font-weight: bold;
        ">New Race</button>
      </div>
    `,e.innerHTML=r}function c(){B.remove()}return{container:B,update:o,showResults:s,destroy:c}}let pt=0;function we(){return Math.random().toString(36).substring(2,10)}function xt(A){for(const B of Qe)if(!A.has(B))return B;return`Player ${++pt}`}function Le(A){for(const B of ke)if(!A.has(B))return B;return`hsl(${Math.random()*360}, 70%, 55%)`}function gt(A,B){const b=document.createElement("div");b.id="lobby-screen",b.style.cssText=`
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    font-family: 'Segoe UI', system-ui, sans-serif;
    color: #fff;
    z-index: 100;
  `;const T=[],d=new Set,e=new Set;let n=4e-4;const o=ke[0];T.push({id:we(),name:"My Marble",color:o,isBot:!1}),e.add(o),d.add("My Marble");function s(){var t,l,f,u,x,S,C;b.innerHTML=`
      <div style="
        background: rgba(0, 0, 0, 0.5);
        border-radius: 20px;
        padding: 40px;
        max-width: 600px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      ">
        <h1 style="text-align: center; margin: 0 0 8px 0; font-size: 26px; color: #ffd700; line-height: 1.3;">
          THE AMAZING RYAN'S RACE FOR ALL THE MARBLES
        </h1>
        <p style="text-align: center; margin: 0 0 32px 0; color: #aaa; font-size: 14px;">
          Set up your marbles and start the race!
        </p>

        <!-- Marble List -->
        <div id="marble-list" style="margin-bottom: 24px;">
          ${T.map((M,p)=>`
            <div style="
              display: flex;
              align-items: center;
              gap: 12px;
              padding: 12px 16px;
              margin-bottom: 8px;
              background: rgba(255, 255, 255, 0.05);
              border-radius: 10px;
              border: 1px solid rgba(255, 255, 255, 0.08);
            ">
              <input type="color" value="${M.color}" data-idx="${p}" class="marble-color"
                style="width: 36px; height: 36px; border: none; border-radius: 50%; cursor: pointer; background: none; padding: 0;" />
              <input type="text" value="${M.name}" data-idx="${p}" class="marble-name"
                maxlength="20"
                style="
                  flex: 1;
                  background: rgba(255, 255, 255, 0.1);
                  border: 1px solid rgba(255, 255, 255, 0.15);
                  color: #fff;
                  padding: 8px 12px;
                  border-radius: 6px;
                  font-size: 15px;
                  outline: none;
                " />
              <span style="color: #666; font-size: 12px; min-width: 40px;">
                ${p===0?"YOU":"P"+(p+1)}
              </span>
              ${p>0?`
                <button data-idx="${p}" class="marble-remove" style="
                  background: rgba(255, 50, 50, 0.3);
                  border: 1px solid rgba(255, 50, 50, 0.4);
                  color: #ff6b6b;
                  width: 32px;
                  height: 32px;
                  border-radius: 6px;
                  cursor: pointer;
                  font-size: 18px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                ">x</button>
              `:'<div style="width: 32px;"></div>'}
            </div>
          `).join("")}
        </div>

        <!-- Add Player Buttons -->
        <div style="display: flex; gap: 12px; margin-bottom: 12px;">
          <button id="btn-add-player" style="
            flex: 1;
            background: rgba(74, 144, 217, 0.3);
            border: 1px solid rgba(74, 144, 217, 0.5);
            color: #7fdbff;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 15px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
          " ${T.length>=te?"disabled":""}>
            + Add Player (${T.length}/${te})
          </button>
          <button id="btn-add-5-players" style="
            background: rgba(74, 144, 217, 0.15);
            border: 1px solid rgba(74, 144, 217, 0.3);
            color: #7fdbff;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
          " ${T.length+5>te?"disabled":""}>
            +5 Players
          </button>
          <button id="btn-bulk-import" style="
            background: rgba(255, 215, 0, 0.15);
            border: 1px solid rgba(255, 215, 0, 0.3);
            color: #ffd700;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
          " ${T.length>=te?"disabled":""}>
            Bulk Import
          </button>
        </div>

        <!-- Bulk Import Panel (hidden by default) -->
        <div id="bulk-import-panel" style="display: none; margin-bottom: 32px;">
          <label style="font-size: 13px; color: #aaa; display: block; margin-bottom: 6px;">
            Enter names separated by commas or new lines (max ${te-T.length} more)
          </label>
          <textarea id="bulk-import-text" placeholder="e.g. Thunderball, Big Red, Slick&#10;Pebble&#10;Cannonball, Dizzy" rows="5"
            style="
              width: 100%;
              box-sizing: border-box;
              background: rgba(255, 255, 255, 0.1);
              border: 1px solid rgba(255, 255, 255, 0.15);
              color: #fff;
              padding: 10px 14px;
              border-radius: 8px;
              font-size: 14px;
              font-family: 'Segoe UI', system-ui, sans-serif;
              outline: none;
              resize: vertical;
            "></textarea>
          <div style="display: flex; gap: 10px; margin-top: 8px;">
            <button id="btn-bulk-add" style="
              flex: 1;
              background: linear-gradient(135deg, #ffd700, #f0a500);
              border: none;
              color: #1a1a2e;
              padding: 10px 20px;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 600;
              cursor: pointer;
              transition: transform 0.1s;
            ">
              Add Players
            </button>
            <button id="btn-bulk-cancel" style="
              background: rgba(255, 255, 255, 0.1);
              border: 1px solid rgba(255, 255, 255, 0.15);
              color: #aaa;
              padding: 10px 16px;
              border-radius: 8px;
              font-size: 14px;
              cursor: pointer;
            ">
              Cancel
            </button>
          </div>
          <p id="bulk-import-status" style="margin: 6px 0 0 0; font-size: 12px; color: #aaa;"></p>
        </div>

        <!-- Track Seed -->
        <div style="margin-bottom: 24px;">
          <label style="font-size: 13px; color: #aaa; display: block; margin-bottom: 6px;">
            Track Seed (leave empty for random)
          </label>
          <input type="number" id="track-seed" placeholder="Random"
            style="
              width: 100%;
              box-sizing: border-box;
              background: rgba(255, 255, 255, 0.1);
              border: 1px solid rgba(255, 255, 255, 0.15);
              color: #fff;
              padding: 10px 14px;
              border-radius: 8px;
              font-size: 15px;
              outline: none;
            " />
        </div>

        <!-- Gravity Slider -->
        <div style="margin-bottom: 24px;">
          <label style="font-size: 13px; color: #aaa; display: flex; justify-content: space-between; margin-bottom: 6px;">
            <span>Gravity</span>
            <span id="gravity-value" style="color: #7fdbff; font-weight: 600;">${n.toFixed(4)}</span>
          </label>
          <input type="range" id="gravity-slider" min="0.0001" max="0.002" step="0.0001" value="${n}"
            style="
              width: 100%;
              accent-color: #4a90d9;
              height: 6px;
              cursor: pointer;
            " />
          <div style="display: flex; justify-content: space-between; font-size: 11px; color: #666; margin-top: 4px;">
            <span>Feather</span>
            <span>Moon</span>
            <span>Normal</span>
            <span>Heavy</span>
          </div>
        </div>

        <!-- Start Race Button -->
        <button id="btn-start-race" style="
          width: 100%;
          background: linear-gradient(135deg, #2ecc40, #27ae60);
          border: none;
          color: #fff;
          padding: 16px 32px;
          font-size: 20px;
          font-weight: bold;
          border-radius: 12px;
          cursor: pointer;
          transition: transform 0.1s, box-shadow 0.2s;
          box-shadow: 0 4px 15px rgba(46, 204, 64, 0.3);
        " ${T.length<2?'disabled style="opacity: 0.5;"':""}>
          START RACE
        </button>
        ${T.length<2?'<p style="text-align: center; color: #ff6b6b; font-size: 13px; margin-top: 8px;">Add at least 2 marbles to race</p>':""}
      </div>
    `,b.querySelectorAll(".marble-name").forEach(M=>{M.addEventListener("change",p=>{const g=parseInt(p.target.dataset.idx),y=p.target.value.trim();y&&(d.delete(T[g].name),T[g].name=y,d.add(y))})}),b.querySelectorAll(".marble-color").forEach(M=>{M.addEventListener("input",p=>{const g=parseInt(p.target.dataset.idx);e.delete(T[g].color),T[g].color=p.target.value,e.add(T[g].color)})}),b.querySelectorAll(".marble-remove").forEach(M=>{M.addEventListener("click",p=>{const g=parseInt(p.currentTarget.dataset.idx);d.delete(T[g].name),e.delete(T[g].color),T.splice(g,1),s()})}),(t=document.getElementById("btn-add-player"))==null||t.addEventListener("click",()=>{T.length>=te||(c(),s())}),(l=document.getElementById("btn-add-5-players"))==null||l.addEventListener("click",()=>{for(let M=0;M<5&&T.length<te;M++)c();s()}),(f=document.getElementById("btn-bulk-import"))==null||f.addEventListener("click",()=>{const M=document.getElementById("bulk-import-panel");M&&(M.style.display=M.style.display==="none"?"block":"none")}),(u=document.getElementById("btn-bulk-cancel"))==null||u.addEventListener("click",()=>{const M=document.getElementById("bulk-import-panel");M&&(M.style.display="none");const p=document.getElementById("bulk-import-text");p&&(p.value="")}),(x=document.getElementById("btn-bulk-add"))==null||x.addEventListener("click",()=>{const M=document.getElementById("bulk-import-text");if(!M||!M.value.trim())return;const p=M.value.split(/[,\n]+/).map(D=>D.trim()).filter(D=>D.length>0).map(D=>D.substring(0,20)),g=[],y=new Set;for(const D of p){const k=D.toLowerCase();y.has(k)||(y.add(k),g.push(D))}const v=te-T.length,w=g.slice(0,v);let h=0;for(const D of w){if(d.has(D)){h++;continue}const k=Le(e);T.push({id:we(),name:D,color:k,isBot:!0}),d.add(D),e.add(k)}const m=w.length-h,P=g.length-w.length,I=[];m>0&&I.push(`Added ${m} player${m!==1?"s":""}`),h>0&&I.push(`${h} duplicate${h!==1?"s":""} skipped`),P>0&&I.push(`${P} skipped (max ${te} players)`);const R=I.length>0?I.join(". ")+".":"";s();const E=document.getElementById("bulk-import-panel");E&&(E.style.display="block");const L=document.getElementById("bulk-import-text");if(L&&(L.value=""),R){const D=document.getElementById("bulk-import-status");D&&(D.textContent=R,D.style.color=m>0?"#2ecc40":"#ff6b6b")}}),(S=document.getElementById("gravity-slider"))==null||S.addEventListener("input",M=>{n=parseFloat(M.target.value);const p=document.getElementById("gravity-value");p&&(p.textContent=n.toFixed(4))}),(C=document.getElementById("btn-start-race"))==null||C.addEventListener("click",()=>{T.length<2||B({marbles:[...T],gravityScale:n})})}function c(){const t=xt(d),l=Le(e);T.push({id:we(),name:t,color:l,isBot:!0}),d.add(t),e.add(l)}function a(){b.style.display="flex",s()}function r(){b.style.display="none"}function i(){b.remove()}return A.appendChild(b),s(),{container:b,show:a,hide:r,destroy:i}}const z={status:"lobby",marbles:[],trackSeed:0,countdownRemaining:0,raceTime:0,results:[]},Me=document.getElementById("app");Me.style.cssText="position: relative; width: 100vw; height: 100vh; overflow: hidden;";const le=document.createElement("div");le.id="game-container";le.style.cssText="position: absolute; top: 0; left: 0; width: 100%; height: 100%;";Me.appendChild(le);let ie,G,re,Ce,Q=null,Z=null,ae=0,Pe=0;ie=lt(le);G=dt(window.innerWidth,window.innerHeight);G.setZoom(.9);re=Oe(le);window.addEventListener("resize",()=>{ie.resize(),G.screenWidth=window.innerWidth,G.screenHeight=window.innerHeight});ie.resize();window.addEventListener("wheel",A=>{if(z.status==="lobby")return;const B=A.deltaY>0?-.1:.1;G.setZoom(G.zoom+B)});Ce=gt(Me,A=>{ht(A)});function ht(A){const{marbles:B,gravityScale:b}=A,T=document.getElementById("track-seed"),d=T!=null&&T.value?parseInt(T.value):Math.floor(Math.random()*999999);z.marbles=B,z.trackSeed=d,z.results=[],z.raceTime=0,z.countdownRemaining=Ye,z.status="countdown",Z=je(d),Q&&Q.destroy(),Q=at(Z,B,b),G.x=Z.startX,G.y=Z.startY;const e=Z.segments[Z.segments.length-1],n=e.points[0],o=e.rightPoints[0];G.finishLineX=(n.x+o.x)/2,G.finishLineY=n.y,Ce.hide(),Pe=performance.now(),ae&&cancelAnimationFrame(ae),$e(performance.now())}function $e(A){const B=Math.min(A-Pe,50);if(Pe=A,z.status==="countdown"&&(z.countdownRemaining-=B/1e3,z.countdownRemaining<=0&&(z.status="racing",z.countdownRemaining=0)),z.status==="racing"&&Q&&Z){Q.update(B),z.raceTime+=B;const b=Q.getMarbleStates();if(G.update(b,B),b.every(d=>d.finished||d.disqualified)&&z.results.length===0){z.status="finished";const d=b.filter(o=>o.finished).sort((o,s)=>(o.finishTime||1/0)-(s.finishTime||1/0)),e=b.filter(o=>o.disqualified);let n=0;z.results=[...d.map(o=>{n++;const s=z.marbles.find(c=>c.id===o.id);return{marbleId:o.id,marbleName:s.name,marbleColor:s.color,position:n,finishTime:o.finishTime||0}}),...e.map(o=>{n++;const s=z.marbles.find(c=>c.id===o.id);return{marbleId:o.id,marbleName:s.name,marbleColor:s.color,position:n,finishTime:-1}})],re.showResults(z.results),setTimeout(()=>{var o;(o=document.getElementById("btn-new-race"))==null||o.addEventListener("click",()=>{vt()})},100)}ie.render(Z,z.marbles,b,G,z.raceTime),re.update(z.marbles,b,z.raceTime,z.status,z.countdownRemaining)}else if(z.status==="countdown"&&Z){const b=(Q==null?void 0:Q.getMarbleStates())||[];G.update(b,B),ie.render(Z,z.marbles,b,G,0),re.update(z.marbles,b,0,"countdown",z.countdownRemaining)}else if(z.status==="finished"&&Z&&Q){const b=Q.getMarbleStates();ie.render(Z,z.marbles,b,G,z.raceTime)}ae=requestAnimationFrame($e)}function vt(){z.status="lobby",Q&&(Q.destroy(),Q=null),Z=null,ae&&(cancelAnimationFrame(ae),ae=0),ie.ctx.clearRect(0,0,ie.canvas.width,ie.canvas.height),re.destroy(),re=Oe(le),Ce.show()}
